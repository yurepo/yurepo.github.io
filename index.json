[{"content":"è‡ºä¸­ç§‘å¤§ 110 å­¸å¹´åº¦æ—¥é–“éƒ¨è¡Œäº‹æ›† ä»Šå¤©åœ¨æ ¡å°ç”Ÿæˆçš„æ—¥æ›†æ™‚ï¼Œçœ‹åˆ°110å­¸å¹´åº¦ä¸‹å­¸æœŸçš„æ—¥æ›†ï¼Œä¸ç¦æœ‰ä¸€äº›æ„Ÿæ…¨ï¼Œå°±åƒæ˜¯åœ‹ä¸­å‡é«˜ä¸­ï¼Œé«˜ä¸­å‡å¤§å­¸ï¼Œç­‰åˆ°æ„è­˜åˆ°è¦ç•¢æ¥­äº†ï¼Œæ‰ç™¼ç¾è‡ªå·±éå»é€™å¹¾å¹´ä¸çŸ¥é“éƒ½åœ¨å¹¹å•¥ã€‚\nå¤§å­¸ç”Ÿæ´»è£¡ï¼Œæœ€å¾Œæ‚”çš„æ˜¯å¤§ä¸€ï¼Œè¨±å¤šæ™‚é–“éƒ½è¢«æµªè²»æ‰äº†ï¼Œç¾åœ¨æƒ³æƒ³å¦‚æœå–„ç”¨é‚£äº›æ™‚é–“ï¼Œæˆ–è¨±å¯ä»¥æŠŠè‡ªå·±çš„ç¨‹åº¦æå‡æ›´å¤šã€‚å¦‚æœæœ‰å‰›å…¥å­¸çš„å¤§ä¸€æ–°ç”Ÿçœ‹åˆ°é€™ç¯‡æ–‡ç« çš„è©±ï¼Œå¸Œæœ›å„ä½å¯ä»¥å–„ç”¨æ™‚é–“å»æå‡è‡ªå·±çš„èƒ½åŠ›ï¼Œä¸è¦åƒæˆ‘ä¸€æ¨£åªæœƒè€å»¢å“ˆå“ˆã€‚\næˆ‘æƒ³æŠ±æ€¨çš„è©±å°±åˆ°æ­¤çµæŸäº†å§ï¼Œæ™‚é–“ä¹Ÿéƒ½å›ä¸å»äº†ã€‚\nè¡Œäº‹æ›† ä»¥ä¸‹æä¾›çš„è¡Œäº‹æ›†éƒ½ä»¥è‡ºä¸­ç§‘å¤§å®˜ç¶²ç‚ºä¸»ã€‚\næ—¥æ›†çš„æ´»å‹•é¡å‹éƒ½ç‚ºå…¨å¤©æ´»å‹•ï¼Œå»ºè­°è¨­å®šé€šçŸ¥æ™‚é–“\nå…±ç”¨é€£çµ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\nå…¬é–‹ç¶²å€ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\niCal æ ¼å¼å…¬é–‹ç¶²å€ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\nQ\u0026amp;A æˆ‘æƒ³å¯èƒ½æœƒæœ‰äººå•èªªï¼šç‚ºä»€éº¼ä¸é–‹æºçµ¦å…¶ä»–äººè‡ªå·±ç”Ÿæˆ?\né€™æ˜¯å› ç‚ºæ¯å­¸å¹´(ç”šè‡³åŒä¸€ä»½æ–‡ä»¶)å­¸æ ¡å®˜ç¶²æä¾›çš„pdfæ–‡ä»¶åœ¨æ ¼å¼ä¸Šéƒ½æœƒæœ‰ä¸€é»å·®ç•°ï¼ŒåŠ ä¸Šæˆ‘æ‡¶ï¼Œé€™ä»½ç¨‹å¼ç¢¼é‚„åœç•™åœ¨å…©ä¸‰å¹´å‰çš„ç‰ˆæœ¬ï¼Œä¸ä¿è­‰åœ¨æœªä¾†ä¸€å®šèƒ½å¤ ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸é–‹æºã€‚\nçµ¦æœ‰èˆˆè¶£çš„äººåƒè€ƒï¼Œä½¿ç”¨èªè¨€ï¼šPython3ï¼Œéœ€è¦å®‰è£çš„å¥—ä»¶ï¼špdfplumber\nçµèª é›–ç„¶å‰å¹¾å¹´éƒ½æœ‰ç”Ÿæˆé€™é¡å‹çš„æ—¥æ›†ï¼Œä½†æƒ³èªªæœ€å¾Œä¸€å¹´äº†å°±åˆ†äº«å‡ºä¾†çµ¦éœ€è¦çš„äººï¼Œå¦‚æœæœ‰å¹«åŠ©åˆ°ä½ å€‘çš„è©±ï¼Œé‚£æˆ‘èŠ±è²»çš„æ™‚é–“ä¹Ÿæœƒè®“æˆ‘æ¯”è¼ƒå¿ƒå®‰ç†å¾—äº†ğŸ˜‚\n","permalink":"https://yurepo.tw/2021/07/%E8%87%BA%E4%B8%AD%E7%A7%91%E5%A4%A7-110-%E5%AD%B8%E5%B9%B4%E5%BA%A6%E8%A1%8C%E4%BA%8B%E6%9B%86/","summary":"è‡ºä¸­ç§‘å¤§ 110 å­¸å¹´åº¦æ—¥é–“éƒ¨è¡Œäº‹æ›† ä»Šå¤©åœ¨æ ¡å°ç”Ÿæˆçš„æ—¥æ›†æ™‚ï¼Œçœ‹åˆ°110å­¸å¹´åº¦ä¸‹å­¸æœŸçš„æ—¥æ›†ï¼Œä¸ç¦æœ‰ä¸€äº›æ„Ÿæ…¨ï¼Œå°±åƒæ˜¯åœ‹ä¸­å‡é«˜ä¸­ï¼Œé«˜ä¸­å‡å¤§å­¸ï¼Œç­‰åˆ°æ„è­˜åˆ°è¦ç•¢æ¥­äº†ï¼Œæ‰ç™¼ç¾è‡ªå·±éå»é€™å¹¾å¹´ä¸çŸ¥é“éƒ½åœ¨å¹¹å•¥ã€‚\nå¤§å­¸ç”Ÿæ´»è£¡ï¼Œæœ€å¾Œæ‚”çš„æ˜¯å¤§ä¸€ï¼Œè¨±å¤šæ™‚é–“éƒ½è¢«æµªè²»æ‰äº†ï¼Œç¾åœ¨æƒ³æƒ³å¦‚æœå–„ç”¨é‚£äº›æ™‚é–“ï¼Œæˆ–è¨±å¯ä»¥æŠŠè‡ªå·±çš„ç¨‹åº¦æå‡æ›´å¤šã€‚å¦‚æœæœ‰å‰›å…¥å­¸çš„å¤§ä¸€æ–°ç”Ÿçœ‹åˆ°é€™ç¯‡æ–‡ç« çš„è©±ï¼Œå¸Œæœ›å„ä½å¯ä»¥å–„ç”¨æ™‚é–“å»æå‡è‡ªå·±çš„èƒ½åŠ›ï¼Œä¸è¦åƒæˆ‘ä¸€æ¨£åªæœƒè€å»¢å“ˆå“ˆã€‚\næˆ‘æƒ³æŠ±æ€¨çš„è©±å°±åˆ°æ­¤çµæŸäº†å§ï¼Œæ™‚é–“ä¹Ÿéƒ½å›ä¸å»äº†ã€‚\nè¡Œäº‹æ›† ä»¥ä¸‹æä¾›çš„è¡Œäº‹æ›†éƒ½ä»¥è‡ºä¸­ç§‘å¤§å®˜ç¶²ç‚ºä¸»ã€‚\næ—¥æ›†çš„æ´»å‹•é¡å‹éƒ½ç‚ºå…¨å¤©æ´»å‹•ï¼Œå»ºè­°è¨­å®šé€šçŸ¥æ™‚é–“\nå…±ç”¨é€£çµ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\nå…¬é–‹ç¶²å€ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\niCal æ ¼å¼å…¬é–‹ç¶²å€ 110-1è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\n110-2è‡ºä¸­ç§‘å¤§æ—¥é–“éƒ¨è¡Œäº‹æ›†\nQ\u0026amp;A æˆ‘æƒ³å¯èƒ½æœƒæœ‰äººå•èªªï¼šç‚ºä»€éº¼ä¸é–‹æºçµ¦å…¶ä»–äººè‡ªå·±ç”Ÿæˆ?\né€™æ˜¯å› ç‚ºæ¯å­¸å¹´(ç”šè‡³åŒä¸€ä»½æ–‡ä»¶)å­¸æ ¡å®˜ç¶²æä¾›çš„pdfæ–‡ä»¶åœ¨æ ¼å¼ä¸Šéƒ½æœƒæœ‰ä¸€é»å·®ç•°ï¼ŒåŠ ä¸Šæˆ‘æ‡¶ï¼Œé€™ä»½ç¨‹å¼ç¢¼é‚„åœç•™åœ¨å…©ä¸‰å¹´å‰çš„ç‰ˆæœ¬ï¼Œä¸ä¿è­‰åœ¨æœªä¾†ä¸€å®šèƒ½å¤ ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸é–‹æºã€‚\nçµ¦æœ‰èˆˆè¶£çš„äººåƒè€ƒï¼Œä½¿ç”¨èªè¨€ï¼šPython3ï¼Œéœ€è¦å®‰è£çš„å¥—ä»¶ï¼špdfplumber\nçµèª é›–ç„¶å‰å¹¾å¹´éƒ½æœ‰ç”Ÿæˆé€™é¡å‹çš„æ—¥æ›†ï¼Œä½†æƒ³èªªæœ€å¾Œä¸€å¹´äº†å°±åˆ†äº«å‡ºä¾†çµ¦éœ€è¦çš„äººï¼Œå¦‚æœæœ‰å¹«åŠ©åˆ°ä½ å€‘çš„è©±ï¼Œé‚£æˆ‘èŠ±è²»çš„æ™‚é–“ä¹Ÿæœƒè®“æˆ‘æ¯”è¼ƒå¿ƒå®‰ç†å¾—äº†ğŸ˜‚","title":"è‡ºä¸­ç§‘å¤§ 110 å­¸å¹´åº¦è¡Œäº‹æ›†"},{"content":"Hugo æ·»åŠ  Google Analytics 4 ç­†è¨˜ å‰è¨€ æœ€è¿‘HUGOæ›´æ–°äº†0.82.0ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬å°æ¯”ä¸Šä¸€ç‰ˆæœ¬æ”¹é€²ä¸å¤§ï¼Œå°æˆ‘ä¾†èªªï¼Œæœ€æœ‰æ„Ÿçš„æ‡‰è©²æ˜¯å¢åŠ äº†å…§ç½®Google Analytics 4çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½¿ç”¨G-é–‹é ­çš„è©•ä¼°IDè€Œä¸æ˜¯UA-é–‹é ­çš„è¿½è¹¤IDï¼Œé‚£é¦–å…ˆå°±ä¾†å›é¡§ä¸€ä¸‹Universal Analytics(GA3)èˆ‡Google Analytics 4ã€‚\nGA4 x GA3 GA3 (Universal Analytics) UAæ–¼2012å¹´10æœˆç™¼å¸ƒï¼Œåœ¨ä¸Šä¸€ä»£GAä¸­ï¼Œä¸»è¦ä»¥ç¶²ç«™æœƒè©±(session)ä»¥åŠç¶²ç«™é é¢ç‚ºä¸»ï¼Œè³‡æ–™çš„ä¾†æºä¸»è¦å¾ä¸‰å€‹ç®¡é“æ”¶é›†\n HTTPè«‹æ±‚ ç€è¦½å™¨/ç³»çµ±è³‡è¨Š ç¬¬ä¸€æ–¹Cookie  å…¶ä¸­ï¼Œæˆ‘å€‘æœ€å®¹æ˜“è¦‹åˆ°çš„æ˜¯å¸¶æœ‰utmé–‹é ­åƒæ•¸çš„é€£çµï¼Œç¯„ä¾‹å¦‚ä¸‹\nhttp://example.com/?utm_source=active%20users\u0026amp;utm_medium=email\u0026amp;utm_campaign=feature...\né€™ç¨®åˆ†äº«é€£çµå¾Œæ–¹éƒ½æœƒæ·»åŠ ä¸€äº›utmé–‹é ­ä¹‹åƒæ•¸ï¼Œé€™å€‹utmåƒæ•¸æœƒè¨˜éŒ„å…¶ä¾†æºã€åª’ä»‹ã€åç¨±ï¼Œç­‰åˆ°ä½¿ç”¨è€…é€ è¨ªç¶²ç«™æ™‚ï¼Œåœ¨ç¶²ç«™ä¸ŠåµŒå…¥çš„UAæœƒå»æ”¶é›†é€™äº›åƒæ•¸ä¸¦ç™¼é€è‡³Google Analyticsï¼Œè®“ç¶²ç«™ç®¡ç†è€…æª¢è¦–ã€åˆ†ææˆæ•ˆã€‚\nä¸Šæ–¹çš„ç¯„ä¾‹åƒ…é™æ–¼ä½¿ç”¨è€…æ˜¯è¢«å“ªå€‹ç¤¾ç¾¤ç¶²ç«™ã€å“ªå€‹å»£å‘Šä»¥åŠå¾å“ªå€‹ä¾†æº(e.g. emailã€app)å¸å¼•è€Œé€²å…¥ç¶²ç«™ï¼Œé‚£å¦‚ä½•å»æ”¶é›†ä½¿ç”¨è€…åœ¨ç¶²ç«™å…§éƒ¨çš„æ´»å‹•å‘¢ğŸ˜¶?\nUAæ“æœ‰è¨±å¤šä¸åŒåŒ¹é…å»æ”¶é›†ä½¿ç”¨è€…åœ¨ç¶²ç«™å…§éƒ¨çš„æ´»å‹•ï¼Œé€™é‚Šä»‹ç´¹æœ€å¸¸è¦‹çš„ä¸‰ç¨®ï¼š\n  ç¶²é ç€è¦½åŒ¹é…\nä½¿ç”¨è€…è¼‰å…¥åµŒæœ‰UAçš„é é¢æ™‚ä¾¿æœƒè§¸ç™¼æ­¤åŒ¹é…ï¼Œæ˜¯æœ€å¸¸è§¸ç™¼çš„æ“ä½œã€‚\n  äº‹ä»¶åŒ¹é…\nè¿½è¹¤ä½¿ç”¨è€…åœ¨ç¶²ç«™ä¸Šç‰¹å®šå…ƒç´ çš„æ¯æ¬¡äº’å‹•ï¼Œä¾‹å¦‚ï¼šé–‹å•Ÿçš„ç¶²å€ã€æ’­æ”¾çš„å½±ç‰‡ç­‰ã€‚\n  äº¤æ˜“åŒ¹é…\nå‚³é€é›»å­å•†å‹™è³¼è²·çš„ç›¸é—œè³‡æ–™ï¼Œä¾‹å¦‚ï¼šå”®å‡ºçš„ç”¢å“ã€äº¤æ˜“IDã€åº«å­˜è¨ˆé‡å–®ä½(SKU)ç­‰ç­‰ã€‚\n  é™¤ä¸Šè¿°ä¸‰ç¨®ä¹‹å¤–ä¹Ÿæœ‰è¨±å¤šå…¶ä»–åŒ¹é…ï¼Œåƒæ˜¯ç¤¾äº¤åŒ¹é…ã€ç¶²é æ“ä½œæ™‚é–“åŒ¹é…ç­‰\nGA4 (Google Analytics 4) GA4æ–¼2020å¹´10æœˆ16æ—¥ç™¼å¸ƒï¼Œåœ¨é€™ä¸€ä»£GAä¸­ï¼Œä¸»è¦æ¡ç”¨ä»¥äº‹ä»¶(event-based)çš„æ–¹å¼å»æ”¶é›†è³‡æ–™ï¼Œç›¸è¼ƒæ–¼ä¸Šä¸€ä»£GA3ï¼ŒGA4æä¾›äº†æ›´å½ˆæ€§ã€æ›´æ™ºæ…§ã€è·¨å¹³å°çš„æ•¸æ“šè’é›†æ–¹æ³•ã€‚\nGA4èˆ‡GA3åŒæ¨£éƒ½ä½¿ç”¨gtag.jså‘Google Analyticsç™¼é€äº‹ä»¶æ•¸æ“šã€‚\nåœ¨ä»¥å¾€çš„GA3ï¼Œå¦‚æœæƒ³è¦è©•ä¼°Appç«¯ä¸Šçš„ä½¿ç”¨æ•¸æ“šï¼Œå¿…é ˆä½¿ç”¨Google Analytics for Firebaseæˆ–æ˜¯Google Analytics APP viewå»ºç«‹ä¸åŒçš„GAè³‡æº(Property)ï¼Œæƒ³è¦çµåˆç¶²é ç«¯åŠAppç«¯çš„ä½¿ç”¨æ•¸æ“šç›¸å°ä¾†èªªæ˜¯è¼ƒä¸å®¹æ˜“çš„ã€‚\nGA4 æ•´åˆäº† Web ç«¯åŠ APP ç«¯çš„è³‡æ–™ï¼Œä¸¦å¯ä»¥å°‡å…¶çµåˆåœ¨ä¸€èµ·é€²è¡Œåˆ†æï¼Œä¹Ÿå¯ä»¥å–®ç¨è’é›†ç¶²ç«™ä¸Šçš„è³‡æ–™ã€‚\nGA4é»˜èªæä¾›äº†å…­ç¨®å¢å¼·æ€§è©•ä¼°\n ç¶²é ç€è¦½ æ²å‹• å¤–é€£é»æ“Š ç«™å…§æœå°‹ å½±ç‰‡åƒèˆ‡ æª”æ¡ˆä¸‹è¼‰  è‹¥è¦è©³ç´°äº†è§£GA4çš„åŠŸèƒ½åŠæ¯”è¼ƒï¼Œå¯è‡³ã€ä¸€è¡¨çœ‹æ‡‚ã€‘æ–°ç‰ˆ GA4 èˆ‡èˆŠç‰ˆ GA å·®åœ¨å“ªè£¡ï¼Ÿæ–°èˆŠç‰ˆæœ¬åŠŸèƒ½æ¯”è¼ƒæ‡¶äººåŒ…ï¼\nTL;DRï¼šæ–°ç‰ˆGA4ç›¸è¼ƒæ–¼ä¸Šä¸€ä»£GA3æ›´å½ˆæ€§ã€æ›´æ™ºæ…§(å¾Œè‡ºæ–¹é¢)ã€è·¨å¹³å°ï¼Œä½†GA3ä¸Šæœ‰çš„åŠŸèƒ½ä¸¦ä¸ä¸€å®šåœ¨GA4ä¸Šå¯ä»¥æ‰¾åˆ°æ›¿ä»£å“ï¼Œè‹¥æ˜¯æ‰“ç®—ç”±GA3é·ç§»åˆ°GA4ï¼Œå¯ä¿ç•™GA3å’ŒGA4å…©è€…ã€‚ä¸éå°æ–¼Hugoä½¿ç”¨è€…ä¾†èªªï¼Œä¸ç®¡æ˜¯é¸æ“‡GA3æˆ–æ˜¯GA4éƒ½æ‡‰è©²å¯ä»¥é”æˆç›®çš„ã€‚\nå¦‚ä½•åœ¨ Hugo è¨­å®š GA4 æ¥ä¸‹ä¾†é€²å…¥åˆ°æ­£é¡Œï¼Œå¦‚ä½•åœ¨æ–°ç‰ˆHugoè¨­å®šGA4å‘¢?\nå…¶å¯¦åœ¨æ–°ç‰ˆHugoè¨­å®šGA4èˆ‡è¨­å®šUAä¸¦ç„¡ä¸åŒ\nç¬¬ä¸€æ­¥ï¼Œè¨­å®šconfig.yml é¦–å…ˆåœ¨éƒ¨è½æ ¼æ ¹ç›®éŒ„çš„config.ymlå¿…é ˆåŠ ä¸Š\ngoogleAnalytics: \u0026lt;GA4_è©•ä¼°_ID\u0026gt; (å–å¾—GA4è©•ä¼°IDè«‹è‡³Google Analyticsï¼Œé€™é‚Šä¸¦ä¸è´…è¿°)\nç¬¬äºŒæ­¥ï¼Œå‘ä¸»é¡Œä¸Šæ–°å¢GA4æ¨¡æ¿ ä¸¦ä¸”åœ¨æ‚¨ä¸»é¡Œçš„æ¨¡æ¿(template)ä¸Šæ–°å¢\n\u0026lt;!-- Add GA4 support --\u0026gt; {{ template \u0026#34;_internal/google_analytics.html\u0026#34; . }} (è¨˜å¾—é€™æ®µæ‡‰åœ¨HTMLä¸­çš„\u0026lt;head\u0026gt;å€æ®µä¸­å¢åŠ )ï¼Œä»¥æˆ‘ç›®å‰ä½¿ç”¨çš„ä¸»é¡ŒPaperModç‚ºç¯„ä¾‹ï¼Œæ‡‰åœ¨...\\themes\\PaperMod\\layouts\\partials\\head.htmlä¸­æ·»åŠ )\nåƒè€ƒè³‡æ–™ Google Analytics - Internal Templates\nã€ä¸€è¡¨çœ‹æ‡‚ã€‘æ–°ç‰ˆ GA4 èˆ‡èˆŠç‰ˆ GA å·®åœ¨å“ªè£¡ï¼Ÿæ–°èˆŠç‰ˆæœ¬åŠŸèƒ½æ¯”è¼ƒæ‡¶äººåŒ…ï¼\nä»€éº¼æ˜¯UTMï¼Ÿå¦‚ä½•ä½¿ç”¨UTMè¿½è¹¤æˆæ•ˆã€æ•¸æ“šèˆ‡æµé‡ï¼Ÿ\né€éè‡ªè¨‚ç¶²å€æ”¶é›†å»£å‘Šæ´»å‹•è³‡æ–™\nè·Ÿè¹¤ä»£ç¢¼æ¦‚è¦½\nHow Google Analytics collects data (5:39)\n","permalink":"https://yurepo.tw/2021/03/hugo-%E6%B7%BB%E5%8A%A0-google-analytics-4-%E7%AD%86%E8%A8%98/","summary":"Hugo æ·»åŠ  Google Analytics 4 ç­†è¨˜ å‰è¨€ æœ€è¿‘HUGOæ›´æ–°äº†0.82.0ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬å°æ¯”ä¸Šä¸€ç‰ˆæœ¬æ”¹é€²ä¸å¤§ï¼Œå°æˆ‘ä¾†èªªï¼Œæœ€æœ‰æ„Ÿçš„æ‡‰è©²æ˜¯å¢åŠ äº†å…§ç½®Google Analytics 4çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½¿ç”¨G-é–‹é ­çš„è©•ä¼°IDè€Œä¸æ˜¯UA-é–‹é ­çš„è¿½è¹¤IDï¼Œé‚£é¦–å…ˆå°±ä¾†å›é¡§ä¸€ä¸‹Universal Analytics(GA3)èˆ‡Google Analytics 4ã€‚\nGA4 x GA3 GA3 (Universal Analytics) UAæ–¼2012å¹´10æœˆç™¼å¸ƒï¼Œåœ¨ä¸Šä¸€ä»£GAä¸­ï¼Œä¸»è¦ä»¥ç¶²ç«™æœƒè©±(session)ä»¥åŠç¶²ç«™é é¢ç‚ºä¸»ï¼Œè³‡æ–™çš„ä¾†æºä¸»è¦å¾ä¸‰å€‹ç®¡é“æ”¶é›†\n HTTPè«‹æ±‚ ç€è¦½å™¨/ç³»çµ±è³‡è¨Š ç¬¬ä¸€æ–¹Cookie  å…¶ä¸­ï¼Œæˆ‘å€‘æœ€å®¹æ˜“è¦‹åˆ°çš„æ˜¯å¸¶æœ‰utmé–‹é ­åƒæ•¸çš„é€£çµï¼Œç¯„ä¾‹å¦‚ä¸‹\nhttp://example.com/?utm_source=active%20users\u0026amp;utm_medium=email\u0026amp;utm_campaign=feature...\né€™ç¨®åˆ†äº«é€£çµå¾Œæ–¹éƒ½æœƒæ·»åŠ ä¸€äº›utmé–‹é ­ä¹‹åƒæ•¸ï¼Œé€™å€‹utmåƒæ•¸æœƒè¨˜éŒ„å…¶ä¾†æºã€åª’ä»‹ã€åç¨±ï¼Œç­‰åˆ°ä½¿ç”¨è€…é€ è¨ªç¶²ç«™æ™‚ï¼Œåœ¨ç¶²ç«™ä¸ŠåµŒå…¥çš„UAæœƒå»æ”¶é›†é€™äº›åƒæ•¸ä¸¦ç™¼é€è‡³Google Analyticsï¼Œè®“ç¶²ç«™ç®¡ç†è€…æª¢è¦–ã€åˆ†ææˆæ•ˆã€‚\nä¸Šæ–¹çš„ç¯„ä¾‹åƒ…é™æ–¼ä½¿ç”¨è€…æ˜¯è¢«å“ªå€‹ç¤¾ç¾¤ç¶²ç«™ã€å“ªå€‹å»£å‘Šä»¥åŠå¾å“ªå€‹ä¾†æº(e.g. emailã€app)å¸å¼•è€Œé€²å…¥ç¶²ç«™ï¼Œé‚£å¦‚ä½•å»æ”¶é›†ä½¿ç”¨è€…åœ¨ç¶²ç«™å…§éƒ¨çš„æ´»å‹•å‘¢ğŸ˜¶?\nUAæ“æœ‰è¨±å¤šä¸åŒåŒ¹é…å»æ”¶é›†ä½¿ç”¨è€…åœ¨ç¶²ç«™å…§éƒ¨çš„æ´»å‹•ï¼Œé€™é‚Šä»‹ç´¹æœ€å¸¸è¦‹çš„ä¸‰ç¨®ï¼š\n  ç¶²é ç€è¦½åŒ¹é…\nä½¿ç”¨è€…è¼‰å…¥åµŒæœ‰UAçš„é é¢æ™‚ä¾¿æœƒè§¸ç™¼æ­¤åŒ¹é…ï¼Œæ˜¯æœ€å¸¸è§¸ç™¼çš„æ“ä½œã€‚\n  äº‹ä»¶åŒ¹é…\nè¿½è¹¤ä½¿ç”¨è€…åœ¨ç¶²ç«™ä¸Šç‰¹å®šå…ƒç´ çš„æ¯æ¬¡äº’å‹•ï¼Œä¾‹å¦‚ï¼šé–‹å•Ÿçš„ç¶²å€ã€æ’­æ”¾çš„å½±ç‰‡ç­‰ã€‚\n  äº¤æ˜“åŒ¹é…\nå‚³é€é›»å­å•†å‹™è³¼è²·çš„ç›¸é—œè³‡æ–™ï¼Œä¾‹å¦‚ï¼šå”®å‡ºçš„ç”¢å“ã€äº¤æ˜“IDã€åº«å­˜è¨ˆé‡å–®ä½(SKU)ç­‰ç­‰ã€‚\n  é™¤ä¸Šè¿°ä¸‰ç¨®ä¹‹å¤–ä¹Ÿæœ‰è¨±å¤šå…¶ä»–åŒ¹é…ï¼Œåƒæ˜¯ç¤¾äº¤åŒ¹é…ã€ç¶²é æ“ä½œæ™‚é–“åŒ¹é…ç­‰\nGA4 (Google Analytics 4) GA4æ–¼2020å¹´10æœˆ16æ—¥ç™¼å¸ƒï¼Œåœ¨é€™ä¸€ä»£GAä¸­ï¼Œä¸»è¦æ¡ç”¨ä»¥äº‹ä»¶(event-based)çš„æ–¹å¼å»æ”¶é›†è³‡æ–™ï¼Œç›¸è¼ƒæ–¼ä¸Šä¸€ä»£GA3ï¼ŒGA4æä¾›äº†æ›´å½ˆæ€§ã€æ›´æ™ºæ…§ã€è·¨å¹³å°çš„æ•¸æ“šè’é›†æ–¹æ³•ã€‚\nGA4èˆ‡GA3åŒæ¨£éƒ½ä½¿ç”¨gtag.jså‘Google Analyticsç™¼é€äº‹ä»¶æ•¸æ“šã€‚\nåœ¨ä»¥å¾€çš„GA3ï¼Œå¦‚æœæƒ³è¦è©•ä¼°Appç«¯ä¸Šçš„ä½¿ç”¨æ•¸æ“šï¼Œå¿…é ˆä½¿ç”¨Google Analytics for Firebaseæˆ–æ˜¯Google Analytics APP viewå»ºç«‹ä¸åŒçš„GAè³‡æº(Property)ï¼Œæƒ³è¦çµåˆç¶²é ç«¯åŠAppç«¯çš„ä½¿ç”¨æ•¸æ“šç›¸å°ä¾†èªªæ˜¯è¼ƒä¸å®¹æ˜“çš„ã€‚\nGA4 æ•´åˆäº† Web ç«¯åŠ APP ç«¯çš„è³‡æ–™ï¼Œä¸¦å¯ä»¥å°‡å…¶çµåˆåœ¨ä¸€èµ·é€²è¡Œåˆ†æï¼Œä¹Ÿå¯ä»¥å–®ç¨è’é›†ç¶²ç«™ä¸Šçš„è³‡æ–™ã€‚\nGA4é»˜èªæä¾›äº†å…­ç¨®å¢å¼·æ€§è©•ä¼°\n ç¶²é ç€è¦½ æ²å‹• å¤–é€£é»æ“Š ç«™å…§æœå°‹ å½±ç‰‡åƒèˆ‡ æª”æ¡ˆä¸‹è¼‰  è‹¥è¦è©³ç´°äº†è§£GA4çš„åŠŸèƒ½åŠæ¯”è¼ƒï¼Œå¯è‡³ã€ä¸€è¡¨çœ‹æ‡‚ã€‘æ–°ç‰ˆ GA4 èˆ‡èˆŠç‰ˆ GA å·®åœ¨å“ªè£¡ï¼Ÿæ–°èˆŠç‰ˆæœ¬åŠŸèƒ½æ¯”è¼ƒæ‡¶äººåŒ…ï¼","title":"Hugo æ·»åŠ  Google Analytics 4 ç­†è¨˜"},{"content":"æ‰‹æŠŠæ‰‹æ•™å­¸: å°‡Hugoéƒ¨è½æ ¼ä½ˆç½²åˆ°Githubä¸Š å‰è¨€ æœ€è¿‘å°‡ä»¥å‰çš„éƒ¨è½æ ¼å¾Hexoé·ç§»åˆ°Hugoä¸Šäº†ï¼Œä¸å¾—ä¸èªªHugoåœ¨ç”¢ç”Ÿéœæ…‹é é¢çš„é€Ÿåº¦æ¯”èµ·Hexoä¾†èªªå¿«äº†å¾ˆå¤šï¼Œå¾—ç›Šæ–¼Hexoè·ŸHugoéƒ½æ˜¯ä½¿ç”¨Markdownæ–‡ä»¶çš„åŸå› ï¼Œåœ¨å…©è€…ä¹‹é–“é€²è¡Œé·ç§»æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œä»Šå¤©å°±ä¾†ç‚ºè‡ªå·±åšå€‹ç­†è¨˜ï¼Œå¸Œæœ›å¤§å®¶çœ‹äº†é€™ç¯‡æ–‡ç« å¾Œï¼Œæ²’æœ‰éƒ¨è½æ ¼çš„éƒ½å¯ä»¥å˜—è©¦å»ºç«‹ä¸€ä¸‹è‡ªå·±çš„éƒ¨è½æ ¼ã€‚\næ•™å­¸é–‹å§‹ é€™é‚Šå®‰è£çš„Hugoç‰ˆæœ¬ç‚ºhugo v0.81.0ï¼Œç’°å¢ƒç‚ºWin10 20H2 x64ï¼Œä½¿ç”¨çš„å·¥å…·ç‚ºgitèˆ‡chocolateyï¼Œè‹¥æ˜¯macOSï¼Œå‰‡å¯ä»¥ä½¿ç”¨Homebrewï¼ŒLinuxçš„éƒ¨åˆ†å‰‡åœ¨é€™é‚Šä¸‹è¼‰\nç¬¬ä¸€æ­¥ï¼Œå®‰è£Hugo é€™é‚Šä¸»è¦å°±ç…§è‘—å®˜æ–¹çš„å¿«é€Ÿé–‹å§‹å»ºç«‹éƒ¨è½æ ¼ï¼Œå› ç‚ºå®˜æ–¹å·²ç¶“å¯«çš„è¶³å¤ æ¸…æ¥šäº†ï¼Œæ‰€ä»¥åœ¨æ­¤è™•åƒ…å¯«Windowsç‰ˆæœ¬çš„å®‰è£éç¨‹\nå¦‚æœè¦å®‰è£æ™®é€šç‰ˆæœ¬çš„Hugoï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤\nchoco install hugo -confirm å¦‚æœè¦å®‰è£Sass/SCSSç‰ˆæœ¬çš„ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤(æœ‰äº›ä¸»é¡Œæœƒè¦æ±‚éœ€è¦hugo-extendedç‰ˆæœ¬)\nchoco install hugo-extended -confirm ç¬¬äºŒæ­¥ï¼Œå»ºç«‹éƒ¨è½æ ¼ å®‰è£å®ŒHugoå¾Œï¼Œå¯ä»¥ä½¿ç”¨hugo versionç¢ºèªæ˜¯å¦å®‰è£æˆåŠŸã€‚\nå®‰è£æˆåŠŸå¾Œï¼Œåœ¨ä½ æƒ³è¦å»ºç«‹éƒ¨è½æ ¼çš„è³‡æ–™å¤¾å…§æ‰“é–‹powershellï¼Œä¸¦æ‰“ä»¥ä¸‹æŒ‡ä»¤å³å¯å»ºç«‹ã€‚\nhugo new site \u0026lt;è³‡æ–™å¤¾åç¨±\u0026gt; å‡ºç¾ä»¥ä¸‹ç•«é¢å°±èªªæ˜å®‰è£æˆåŠŸäº†!\nç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ ä¸»é¡Œ æ¥ä¸‹ä¾†åˆ°å®˜æ–¹çš„ä¸»é¡Œç¶²ç«™æŒ‘é¸æ‚¨å–œæ­¡çš„ä¸»é¡Œï¼Œæ­¤ç¯„ä¾‹ä½¿ç”¨anankeä¸»é¡Œã€‚\nåªéœ€è¦æ‰“ä»¥ä¸‹æŒ‡ä»¤å°±å¯ä»¥æ–°å¢ä¸»é¡Œäº†\ncd \u0026lt;è³‡æ–™å¤¾åç¨±\u0026gt; git init git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke æ¥è‘—ä¿®æ”¹config.tomlæ–‡ä»¶ï¼Œè©³ç´°çš„è¨­å®šæ–¹å¼å¯ä»¥åƒç…§å®˜ç¶²\n# åŸºæœ¬è¨­ç½® baseURL = \u0026#34;\u0026lt;ç¶²å€\u0026gt;\u0026#34; title = \u0026#34;\u0026lt;æ¨™é¡Œ\u0026gt;\u0026#34; languageCode = \u0026#34;en-us\u0026#34; # ä¸»é¡Œè¨­ç½® theme=\u0026#34;ananke\u0026#34; # é€£çµè¨­ç½® [permalinks] posts = \u0026#34;/:year/:month/:title/\u0026#34; ç¬¬å››æ­¥ï¼Œå»ºç«‹ç¬¬ä¸€ç¯‡è²¼æ–‡ æ¥è‘—è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å»ºç«‹ç¬¬ä¸€ç¯‡è²¼æ–‡\nhugo new posts/hello-world.md æ¥è‘—æ‰“é–‹Markdownç·¨è¼¯å·¥å…·(e.g. Visual Studio Code)ï¼Œå¯«é»ç°¡å–®çš„æ–‡ç« ä¸¦å­˜æª”ã€‚\n--- title: \u0026#34;Hello World\u0026#34; date: 2021-03-21T21:46:28+08:00 draft: false --- # Hello world æˆ‘åœ¨`2021-03-21`å»ºç«‹äº†ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ ç¬¬äº”æ­¥ï¼Œé è¦½ç¶²ç«™ å°±è·ŸHexoä¸€æ¨£ï¼ŒHugoä¹Ÿæä¾›äº†æœ¬åœ°ä¼ºæœå™¨çš„åŠŸèƒ½ï¼Œåƒ…éœ€åœ¨éƒ¨è½æ ¼è³‡æ–™å¤¾ä¸‹ä½¿ç”¨powershellæˆ–cmdæ‰“hugo server -Då°±å¯ä»¥åœ¨æœ¬åœ°ç«¯é è¦½ç¶²ç«™ï¼Œé è¨­ç¶²å€ç‚º: http://localhost:1313/\nç¬¬å…­æ­¥ï¼Œå°‡Hugoéƒ¨è½æ ¼æ”¾åˆ°Githubä¸Š æ¥ä¸‹ä¾†ï¼Œåœ¨githubå»ºç«‹ä¸€å€‹å­˜æ”¾ç¶²ç«™ç”¨çš„Repositoryï¼Œä¸¦å°‡å…¶å‘½åç‚º\n\u0026lt;username\u0026gt;.github.io\nè¨»: usernameå¿…é ˆæ˜¯æ‚¨åœ¨Githubä¸Šçš„çš„ä½¿ç”¨è€…åç¨±\næ¥ä¸‹ä¾†ï¼Œåœ¨éƒ¨è½æ ¼è³‡æ–™å¤¾ä¸‹å»ºç«‹ä¸€æ¢gh-pagesåˆ†æ”¯(branch)ï¼Œé€™å€‹åˆ†æ”¯æ˜¯ç”¨ä¾†å±•ç¤ºéœæ…‹é é¢çš„ï¼Œæˆ‘å€‘ç¨å¾Œæœƒä½¿ç”¨Github Actionå°‡ä¸»åˆ†æ”¯çš„å…§å®¹é€éè‡ªå‹•åŒ–éƒ¨ç½²çš„æ–¹å¼ï¼Œè‡ªå‹•ç”¢ç”Ÿéœæ…‹æ–‡ä»¶åˆ°gh-pagesåˆ†æ”¯ä¸Šã€‚\n# åŠ å…¥æ‰€æœ‰æª”æ¡ˆ git add . # æ–°å¢commitå…§å®¹ git commit -m \u0026#34;init blog\u0026#34; # æ–°å¢mainåˆ†æ”¯ git branch -M main # æ–°å¢é ç«¯ç‰ˆæœ¬åº« git remote add origin https://github.com/\u0026lt;ä½¿ç”¨è€…åç¨±\u0026gt;/\u0026lt;ä½¿ç”¨è€…åç¨±\u0026gt;.github.io.git # å°‡éƒ¨è½æ ¼å…§å®¹ä¸Šå‚³åˆ°remote git push -u origin main # æ–°å¢gh-pageså­¤å…’åˆ†æ”¯ git checkout --orphan gh-pages # ç æ‰gh-pagesåˆ†æ”¯çš„æ‰€æœ‰æª”æ¡ˆ git rm -rf . # æ–°å¢ä¸€å€‹README.mdæª” echo \u0026#34;gh-pages\u0026#34; \u0026gt; \u0026#34;README.md\u0026#34; # åŠ å…¥æ‰€æœ‰æª”æ¡ˆ git add . # æ–°å¢commitå…§å®¹ git commit -m \u0026#34;init gh-pages branch\u0026#34; # å°‡åˆ†æ”¯å…§å®¹ä¸Šå‚³åˆ°remote git push -u origin gh-pages # åˆ‡æ›åˆ°mainåˆ†æ”¯ git checkout main å°‡ä¸Šé¢çš„æŒ‡ä»¤æ‰“å®Œå¾Œï¼Œç…§ç†ä¾†è¬›æœƒå‡ºç¾å…©å€‹åˆ†æ”¯ï¼Œä¸€å€‹å«åšmainï¼Œå¦ä¸€å€‹å«åšgh-pages\nç¬¬ä¸ƒæ­¥ï¼Œè¨­å®šGithub Actioné€²è¡Œè‡ªå‹•åŒ–éƒ¨ç½² è¦æ€éº¼å°‡mainåˆ†æ”¯ä¸Šçš„hugoæª”æ¡ˆï¼Œè‡ªå‹•åŒ–éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯ä¸Šå‘¢?\nå‰ç½®ä½œæ¥­ é¦–å…ˆæˆ‘å€‘å…ˆåˆ°é€™å€‹é é¢å»å–å¾—æˆ‘å€‘çš„Personal Access Token (ç­‰ç­‰æœƒç”¨åˆ°)ã€‚\nå°‡workflowé‚£ä¸€é …æ‰“å‹¾ä¹‹å¾Œåˆ°é é¢æœ€ä¸‹æ–¹æŒ‰ä¸‹Generate Token\nå°‡ç”¢ç”Ÿå‡ºä¾†çš„ä»¤ç‰Œå…ˆè¤‡è£½èµ·ä¾†\næ¥ä¸‹ä¾†åˆ°ä½ å­˜æ”¾Hugoéƒ¨è½æ ¼çš„Repository \u0026gt; Settings \u0026gt; Secret \u0026gt; New repository secretæ–°å¢ä½ å‰›å–å¾—çš„ä»¤ç‰Œ\nå°‡Nameå–ç‚ºHUGO_DEPLOY_TOKENï¼ŒValueè¨­å®šç‚ºå‰›å–å¾—çš„ä»¤ç‰Œï¼ŒæŒ‰ä¸‹Add Secret\nè‡³æ­¤å‰ç½®å‹•ä½œå®Œæˆï¼Œæ¥ä¸‹ä¾†é–‹å§‹è¨­å®šworkflow\nè¨­å®šworkflow æˆ‘å€‘å°‡æœƒåƒè€ƒæ­¤æ–‡çš„workflowæ–‡ä»¶å»è¨­å®šGithub Actionã€‚\né¦–å…ˆï¼Œé€²åˆ°Github Actioné é¢ï¼Œä¸¦é»é¸set up a workflow your self\nå°‡ä¸‹é¢çš„æ–‡ä»¶è²¼ä¸Šä¸¦ä¿®æ”¹ä¸€äº›è¨­å®š(e.g. name)\nname: \u0026lt;workflowåç¨±\u0026gt; on: push: branches: - main  # ç•¶mainåˆ†æ”¯æœ‰pushæ“ä½œæ™‚ jobs: deploy: runs-on: ubuntu-18.04 steps: - uses: actions/checkout@v2 with: submodules: true # æ‰¾å°‹Hugoä¸»é¡Œ(true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.81.0\u0026#39; # hugo ç‰ˆæœ¬ # extended: true # å¦‚æœæ˜¯ä½¿ç”¨extendedç‰ˆæœ¬çš„å‹™å¿…å–æ¶ˆè¨»è§£ã€‚ - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.HUGO_DEPLOY_TOKEN }} PUBLISH_BRANCH: gh-pages  # æ¨é€åˆ° gh-pages åˆ†æ”¯ PUBLISH_DIR: ./public  # hugo ç”Ÿæˆçš„ç›®éŒ„ commit_message: ${{ github.event.head_commit.message }} æ‰“å¥½å¾ŒæŒ‰ä¸‹å³ä¸Šè§’çš„Start commitå„²å­˜å®Œworkflowçš„è¨­å®šæ–‡ä»¶å¾Œå°±å¯ä»¥åœ¨Repositoryçš„Actioné é¢çœ‹åˆ°workflowçš„åŸ·è¡Œç‹€æ…‹\nè‹¥åŸ·è¡Œç‹€æ…‹ç‚ºç¶ è‰²æ‰“å‹¾å³ç‚ºéƒ¨ç½²æˆåŠŸ!\nç¬¬å…«æ­¥ï¼Œéƒ¨è½æ ¼å»ºç½® æœ€å¾Œä¸€æ­¥ï¼Œåˆ°ä½ å­˜æ”¾Hugoéƒ¨è½æ ¼çš„Repository \u0026gt; Settingså…§ï¼Œå°‡GitHub Pagesçš„åˆ†æ”¯æ”¹ç‚ºgh-pageså°±å¤§åŠŸå‘Šæˆäº†!\nä¹‹å¾Œæ–°å¢æ–‡ç« åªéœ€è¦ä¸‰å€‹æ­¥é©Ÿ\n å»ºç«‹æ–°çš„è²¼æ–‡ æ’°å¯«è²¼æ–‡ ä¸Šå‚³æ•´å€‹hugoæ–‡ä»¶å¤¾åˆ°github  å‰©ä¸‹çš„éœæ…‹æ–‡ä»¶ç”¢ç”Ÿæœƒç”±Github Actionå¹«ä½ è™•ç†ä¸¦è‡ªå‹•å¹«ä½ éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯ä¸Šã€‚\nçµèª è‡³æ­¤åªéœ€è¦ç°¡å–®å¹¾å€‹æ­¥é©Ÿå°±å¯ä»¥å»ºç«‹Hugoç¶²ç«™ä¸¦å°‡ç¶²ç«™Hoståˆ°Github Pagesä¸Šäº†ï¼Œå¸Œæœ›å¯ä»¥å¹«åŠ©åˆ°æƒ³è¦å»ºç«‹è‡ªå·±éƒ¨è½æ ¼çš„äººï¼\n","permalink":"https://yurepo.tw/2021/03/%E5%A6%82%E4%BD%95%E5%B0%87hugo%E9%83%A8%E8%90%BD%E6%A0%BC%E9%83%A8%E7%BD%B2%E5%88%B0github%E4%B8%8A/","summary":"æ‰‹æŠŠæ‰‹æ•™å­¸: å°‡Hugoéƒ¨è½æ ¼ä½ˆç½²åˆ°Githubä¸Š å‰è¨€ æœ€è¿‘å°‡ä»¥å‰çš„éƒ¨è½æ ¼å¾Hexoé·ç§»åˆ°Hugoä¸Šäº†ï¼Œä¸å¾—ä¸èªªHugoåœ¨ç”¢ç”Ÿéœæ…‹é é¢çš„é€Ÿåº¦æ¯”èµ·Hexoä¾†èªªå¿«äº†å¾ˆå¤šï¼Œå¾—ç›Šæ–¼Hexoè·ŸHugoéƒ½æ˜¯ä½¿ç”¨Markdownæ–‡ä»¶çš„åŸå› ï¼Œåœ¨å…©è€…ä¹‹é–“é€²è¡Œé·ç§»æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œä»Šå¤©å°±ä¾†ç‚ºè‡ªå·±åšå€‹ç­†è¨˜ï¼Œå¸Œæœ›å¤§å®¶çœ‹äº†é€™ç¯‡æ–‡ç« å¾Œï¼Œæ²’æœ‰éƒ¨è½æ ¼çš„éƒ½å¯ä»¥å˜—è©¦å»ºç«‹ä¸€ä¸‹è‡ªå·±çš„éƒ¨è½æ ¼ã€‚\næ•™å­¸é–‹å§‹ é€™é‚Šå®‰è£çš„Hugoç‰ˆæœ¬ç‚ºhugo v0.81.0ï¼Œç’°å¢ƒç‚ºWin10 20H2 x64ï¼Œä½¿ç”¨çš„å·¥å…·ç‚ºgitèˆ‡chocolateyï¼Œè‹¥æ˜¯macOSï¼Œå‰‡å¯ä»¥ä½¿ç”¨Homebrewï¼ŒLinuxçš„éƒ¨åˆ†å‰‡åœ¨é€™é‚Šä¸‹è¼‰\nç¬¬ä¸€æ­¥ï¼Œå®‰è£Hugo é€™é‚Šä¸»è¦å°±ç…§è‘—å®˜æ–¹çš„å¿«é€Ÿé–‹å§‹å»ºç«‹éƒ¨è½æ ¼ï¼Œå› ç‚ºå®˜æ–¹å·²ç¶“å¯«çš„è¶³å¤ æ¸…æ¥šäº†ï¼Œæ‰€ä»¥åœ¨æ­¤è™•åƒ…å¯«Windowsç‰ˆæœ¬çš„å®‰è£éç¨‹\nå¦‚æœè¦å®‰è£æ™®é€šç‰ˆæœ¬çš„Hugoï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤\nchoco install hugo -confirm å¦‚æœè¦å®‰è£Sass/SCSSç‰ˆæœ¬çš„ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤(æœ‰äº›ä¸»é¡Œæœƒè¦æ±‚éœ€è¦hugo-extendedç‰ˆæœ¬)\nchoco install hugo-extended -confirm ç¬¬äºŒæ­¥ï¼Œå»ºç«‹éƒ¨è½æ ¼ å®‰è£å®ŒHugoå¾Œï¼Œå¯ä»¥ä½¿ç”¨hugo versionç¢ºèªæ˜¯å¦å®‰è£æˆåŠŸã€‚\nå®‰è£æˆåŠŸå¾Œï¼Œåœ¨ä½ æƒ³è¦å»ºç«‹éƒ¨è½æ ¼çš„è³‡æ–™å¤¾å…§æ‰“é–‹powershellï¼Œä¸¦æ‰“ä»¥ä¸‹æŒ‡ä»¤å³å¯å»ºç«‹ã€‚\nhugo new site \u0026lt;è³‡æ–™å¤¾åç¨±\u0026gt; å‡ºç¾ä»¥ä¸‹ç•«é¢å°±èªªæ˜å®‰è£æˆåŠŸäº†!\nç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ ä¸»é¡Œ æ¥ä¸‹ä¾†åˆ°å®˜æ–¹çš„ä¸»é¡Œç¶²ç«™æŒ‘é¸æ‚¨å–œæ­¡çš„ä¸»é¡Œï¼Œæ­¤ç¯„ä¾‹ä½¿ç”¨anankeä¸»é¡Œã€‚\nåªéœ€è¦æ‰“ä»¥ä¸‹æŒ‡ä»¤å°±å¯ä»¥æ–°å¢ä¸»é¡Œäº†\ncd \u0026lt;è³‡æ–™å¤¾åç¨±\u0026gt; git init git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke æ¥è‘—ä¿®æ”¹config.tomlæ–‡ä»¶ï¼Œè©³ç´°çš„è¨­å®šæ–¹å¼å¯ä»¥åƒç…§å®˜ç¶²\n# åŸºæœ¬è¨­ç½® baseURL = \u0026#34;\u0026lt;ç¶²å€\u0026gt;\u0026#34; title = \u0026#34;\u0026lt;æ¨™é¡Œ\u0026gt;\u0026#34; languageCode = \u0026#34;en-us\u0026#34; # ä¸»é¡Œè¨­ç½® theme=\u0026#34;ananke\u0026#34; # é€£çµè¨­ç½® [permalinks] posts = \u0026#34;/:year/:month/:title/\u0026#34; ç¬¬å››æ­¥ï¼Œå»ºç«‹ç¬¬ä¸€ç¯‡è²¼æ–‡ æ¥è‘—è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å»ºç«‹ç¬¬ä¸€ç¯‡è²¼æ–‡\nhugo new posts/hello-world.md æ¥è‘—æ‰“é–‹Markdownç·¨è¼¯å·¥å…·(e.g. Visual Studio Code)ï¼Œå¯«é»ç°¡å–®çš„æ–‡ç« ä¸¦å­˜æª”ã€‚","title":"å¦‚ä½•å°‡Hugoéƒ¨è½æ ¼éƒ¨ç½²åˆ°Githubä¸Š?"},{"content":"ä»¤ç‰Œæ¡¶æ¼”ç®—æ³•å¯¦ç¾ å‰è¨€ é€™å¹¾å¤©å°‡ä»¤ç‰Œæ¡¶é™æµæ¼”ç®—æ³•ä½¿ç”¨gin + rediså¯¦ç¾äº†ï¼Œä»Šå¤©ä¸»è¦è¦ä¾†è¬›æ•´å€‹é™æµéç¨‹æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚\nGithubé€£çµ\nä¸»è¦å®šç¾©äº†å››å€‹æ–‡ä»¶\n   æ–‡ä»¶å æè¿°     dto.go å®šç¾©åŠå®£å‘ŠRatelimiterçš„åŸºæœ¬çµæ§‹èˆ‡æ ¸å¿ƒTake()æ–¹æ³•   err.go å®šç¾©äº†ä¸€äº›éŒ¯èª¤   ratelimiter.go å­˜æ”¾gin middlewareä¸­é©—è­‰çš„é‚è¼¯   script.go å­˜æ”¾ lua è…³æœ¬åŠ lua è…³æœ¬ä¸­è¼¸å…¥è®Šæ•¸çš„çµæ§‹    æˆ‘å€‘æœƒå°‡ä¸Šæ¬¡æ›´æ–°çš„æ™‚é–“èˆ‡å‰©é¤˜ä»¤ç‰Œçš„æ•¸é‡å„²å­˜åœ¨Redisä¸­ï¼Œè€Œä¸»è¦æ›´æ–°çš„é‚è¼¯æœƒå¯«åœ¨script.goï¼Œé€™è£¡æœƒç™¼ç¾æ•´å€‹æ“ä½œRedisè³‡æ–™åº«çš„é‚è¼¯æ˜¯ä½¿ç”¨lua scriptå»å¯¦ä½œçš„ï¼ŒæŠŠå¤šå€‹æ“ä½œRedisçš„æŒ‡ä»¤åŒ…åœ¨lua scriptä¸­ï¼ŒRedisæœƒä¿è­‰lua scriptä¸­çš„å¤šå€‹æ“ä½œæœƒä»¥Atomicçš„æ–¹å¼é€²è¡Œï¼Œé€™æ¨£æ‰å¯ä»¥ä¿è­‰æ¯å€‹æ“ä½œä¹‹é–“ä¸æœƒæœ‰ç«¶çˆ­æƒ…æ³(Race Condition)ç™¼ç”Ÿã€‚ åƒè€ƒè³‡æ–™\nç¨‹å¼ç¢¼éƒ¨åˆ† Golang æ¥ä¸‹ä¾†å°±é€²å…¥åˆ°ç¨‹å¼ç¢¼çš„éƒ¨åˆ† é¦–å…ˆæˆ‘å®šç¾©äº† RedisRateLimiter çµæ§‹\ndto.go\ntype RedisRateLimiter struct { context context.Context scriptSHA1 string client *redis.Client } é€™é‚Šå°‡RedisRateLimiterçš„ä¸€äº›å¿…é ˆç”¨åˆ°çš„è®Šæ•¸åŒ…è£èµ·ä¾†ï¼ŒåŒ…è£çš„è®Šæ•¸å‹åˆ¥åŒ…å«äº†Rediså®¢æˆ¶ç«¯ã€LUA Script SHA1(å¾ŒçºŒæœƒä½¿ç”¨evalshaèª¿ç”¨å·²ç¶“è®€é€²Redisè…³æœ¬ç·©å­˜çš„Lua script)ã€Goroutine contextã€‚\né€™å€‹Repositoryå¯¦ç¾çš„æ¼”ç®—æ³•æ˜¯Token Bucketæ¼”ç®—æ³•ï¼Œä¸éä¹Ÿå¯ä»¥åˆ©ç”¨ä¸Šè¿°å®šç¾©çš„çµæ§‹å»å¯¦ç¾ä¸åŒç®—æ³•ï¼Œä¾‹å¦‚ï¼šLeaky Bucketã€‚\ndto.go\ntype TokenBucketRedisRateLimiter struct { RedisRateLimiter identifier string interval time.Duration maxRequest int } func (r *TokenBucketRedisRateLimiter) Take(request TokenBucketLuaRequest) *LimiterResponse { result, err := r.client.EvalSha( r.context, r.scriptSHA1, []string{request.valueKey, request.timestampKey}, request.limit, request.interval, request.batchSize, ).Result() if err != nil { return \u0026amp;LimiterResponse { status: false, remain: 0, err: err, } } else { data := result.([]interface{}) if len(data) != 2 { return \u0026amp;LimiterResponse{ status: false, remain: 0, err: ErrRedisError, } } return \u0026amp;LimiterResponse{ status: data[0] == nil, remain: data[1].(int64), err: nil, } } } é€™é‚Šçš„é‚è¼¯å¾ˆç°¡å–®ï¼Œå°±æ˜¯é€éRedis.ClientåŸ·è¡Œå­˜å…¥çš„Lua Scriptï¼Œä¸¦å›å‚³å…¶åŸ·è¡Œçµæœï¼Œå¾—ç›Šæ–¼Rediså–®ç·šç¨‹çš„å„ªé»ï¼Œä½¿ç”¨Lua Scriptä¸æœƒç™¼ç”ŸRace Conditionã€‚(å› ç‚ºåŸ·è¡ŒLua Scriptæ™‚ï¼ŒRedisæ˜¯å°‡Lua Scriptè¦–ç‚ºä¸€å€‹Atomicçš„æ“ä½œã€‚)\nratelimiter.go\nfunc (r *TokenBucketRedisRateLimiter) Middleware() gin.HandlerFunc { return func(context *gin.Context) { ip := context.ClientIP() if ip == \u0026#34;\u0026#34; { _ = context.AbortWithError(http.StatusInternalServerError, ErrIpNotRecognize) } request := TokenBucketLuaRequest{ valueKey: fmt.Sprintf(\u0026#34;%v_%v_Token\u0026#34;, r.identifier, ip), timestampKey: fmt.Sprintf(\u0026#34;%v_%v_Update_Time\u0026#34;, r.identifier, ip), limit: int64(r.maxRequest), interval: r.interval.Milliseconds(), batchSize: 1, } response := r.Take(request) if response.status { context.Writer.Header().Set(\u0026#34;X-RateLimit-Remaining\u0026#34;, strconv.FormatInt(response.remain, 10)) context.Writer.Header().Set(\u0026#34;X-RateLimit-Limit\u0026#34;, strconv.Itoa(r.maxRequest)) context.Next() } else { _ = context.AbortWithError(http.StatusTooManyRequests, TooManyRequest) } } } func NewRedisRateLimiter(ctx context.Context, identifier string,interval time.Duration, times int, redisClient *redis.Client) *TokenBucketRedisRateLimiter { script := TokenBucketLuaScript scriptSHA1 := fmt.Sprintf(\u0026#34;%x\u0026#34;, sha1.Sum([]byte(script))) if !redisClient.ScriptExists(ctx, scriptSHA1).Val()[0] { redisClient.ScriptLoad(ctx, script).Val() } return \u0026amp;TokenBucketRedisRateLimiter{ RedisRateLimiter: RedisRateLimiter{ context: ctx, scriptSHA1: scriptSHA1, client: redisClient, }, identifier: identifier, interval: interval, maxRequest: times, } } TokenBucketRedisRateLimiterå‚³å…¥çš„è®Šæ•¸æ„ç¾©\n   æ–‡ä»¶å æè¿°     RedisRateLimiter å‚³å…¥Rediså®¢æˆ¶ç«¯åŠè…³æœ¬sha1åŠGoroutineä¸Šä¸‹æ–‡   identifier å€åˆ¥ä¸åŒmiddlewareçš„å€¼ï¼Œ   interval ä»¤ç‰ŒéæœŸæ™‚é–“   maxRequest æœ€å¤§è«‹æ±‚é‡    Middleware é‹ä½œæ­¥é©Ÿï¼š\n å–å¾—å®¢æˆ¶ç«¯IPï¼Œè‹¥ç‚ºç©ºå›å‚³500éŒ¯èª¤ å»ºç«‹è¦é€åˆ°Luaè…³æœ¬çš„è«‹æ±‚. èª¿ç”¨Luaè…³æœ¬ä¸¦è¿”å›çµæœ è‹¥çµæœç‚ºæœªè¢«æ‹’çµ•(rejected: false)ï¼Œè¨­ç½®å›å‚³Header: X-RateLimit-RemainingåŠX-RateLimit-Limitï¼Œåä¹‹å‰‡å›å‚³429éŒ¯èª¤ã€‚  Lua Script æœ€é—œéµçš„Lua Scriptæˆ‘å€‘åˆ†å¹¾å€‹éƒ¨åˆ†ä¾†çœ‹å®ƒã€‚\nç¬¬ä¸€å€‹éƒ¨åˆ†ï¼š å‚³å…¥è®Šæ•¸\n-- Request value local valueKey = KEYS[1] local timestampKey = KEYS[2] local limit = tonumber(ARGV[1]) local interval = tonumber(ARGV[2]) -- milliseconds local batchSize = math.max(tonumber(ARGV[3]), 0) é€™é‚Šåšå€‹è¡¨æ ¼ç°¡å–®è¡¨ç¤ºä¸€ä¸‹è®Šæ•¸ä»£è¡¨çš„æ„æ€\n   è®Šæ•¸å æè¿°     valueKey ä»¤ç‰Œæ•¸é‡   timestampKey ä¸Šæ¬¡å­˜å–çš„æ™‚é–“æˆ³(ms)   limit æœ€å¤§ä»¤ç‰Œé‡   interval ä»¤ç‰ŒéæœŸæ™‚é–“   batchSize åŸ·è¡Œæ“ä½œéœ€è¦æ¶ˆè€—çš„ä»¤ç‰Œé‡    Token Bucket æ¼”ç®—æ³•æ˜¯é€éå‰©é¤˜çš„ä»¤ç‰Œé‡å»è©•ä¼°è«‹æ±‚æ˜¯å¦å¯ä»¥è¢«åŸ·è¡Œï¼Œé‚£é€™é‚Šå°±æœƒç™¼ç¾ä¸€å€‹å•é¡Œäº†ï¼ŒRedisåªå„²å­˜äº†ä¸Šæ¬¡ä»¤ç‰Œå‰©é¤˜é‡ç‚ºå¤šå°‘ï¼Œæ‰€ä»¥å¿…é ˆé€étimestampKeyæ±‚å¾—ç•¶å‰å‰©é¤˜é‡ï¼Œè¨ˆç®—æ–¹å¼æ‡‰ç‚ºï¼šä¸Šæ¬¡å‰©é¤˜ä»¤ç‰Œ + å¾ä¸Šæ¬¡å­˜å–æ™‚é–“åˆ°ç›®å‰æ™‚é–“ç´¯ç©çš„ä»¤ç‰Œé‡ã€‚\n-- Response value local rejected = false local remainToken = 0 é€™é‚Šå°±åƒ…é™„ä¸Šè®Šæ•¸ä»£è¡¨çš„æ„ç¾©ï¼Œå¾ŒçºŒèªªæ˜æ™‚æœƒæåˆ°é€™å…©å€‹è®Šæ•¸ã€‚\n   è®Šæ•¸å æè¿°     rejected æ˜¯å¦è¢«æ‹’çµ•   remainToken å‰©é¤˜ä»¤ç‰Œæ•¸é‡    redis.replicate_commands() local time = redis.call(\u0026#39;TIME\u0026#39;) local currentTime = math.floor(time[1] * 1000 + time[2] / 1000) local modified = false local lastRemainToken = redis.call(\u0026#39;GET\u0026#39;, valueKey) local lastUpdateTime = false if lastRemainToken == false then lastRemainToken = 0 lastUpdateTime = currentTime - interval else lastUpdateTime = redis.call(\u0026#39;GET\u0026#39;, timestampKey) if lastUpdateTime == false then modified = true lastUpdateTime = currentTime - ((lastRemainToken / limit) * interval) end end redis.replicate_commands(): åœ¨Redis 3.2ä»¥å‰ï¼ŒLuaè…³æœ¬çš„æ’°å¯«å¿…é ˆéƒ½æ˜¯ç¢ºå®šæ€§çš„ï¼Œä¹Ÿå°±æ˜¯èªªå‡è¨­ä»Šå¤©æœ‰1å€‹masterèˆ‡2å€‹slave instanceï¼Œé‚£Luaè…³æœ¬å¿…é ˆåœ¨ä¸‰å€‹instanceä¸­éƒ½ç”¢ç”Ÿç›¸åŒçš„çµæœï¼Œæ‰€ä»¥å°±æœƒå°è‡´ä¸€äº›éç¢ºå®šæ€§çš„æŒ‡ä»¤ä¸èƒ½ä½¿ç”¨ï¼Œåƒæ˜¯redis.call('TIME')ï¼Œæ‰€ä»¥åœ¨Redis 3.2å¾Œè‹¥è¦ä½¿ç”¨éç¢ºå®šæ€§æŒ‡ä»¤çš„è©±éœ€è¦èª¿ç”¨æ­¤å‡½æ•¸ã€‚Redis 5å¾Œå·²å°‡è…³æœ¬æ•ˆæœè¤‡è£½æ¨¡å¼è¨­ç‚ºé»˜èªï¼Œå› æ­¤ä¸éœ€è¦é¡¯å¼èª¿ç”¨)\né¦–å…ˆæˆ‘å€‘è¦å–å¾—ç¾åœ¨æ™‚é–“(ms)ï¼Œé€™é‚Šçš„redis.call('TIME')æœƒå›å‚³å…©å€‹å€¼å›ä¾†ï¼Œä¸€å€‹æ˜¯Unix timestamp(ä»¥ç§’ç‚ºå–®ä½)ä¸€å€‹æ˜¯ç•¶å‰æ™‚é–“(å¾®ç§’)ï¼Œæ‰€ä»¥ç•¶å‰æ™‚é–“æˆ³(ä»¥æ¯«ç§’ç‚ºå–®ä½)è¨ˆç®—å…¬å¼æ˜¯math.floor(time[1] * 1000 + time[2] / 1000)ã€‚\næ¥ä¸‹ä¾†éœ€è¦å–å¾—ä¸Šæ¬¡å‰©é¤˜çš„ä»¤ç‰Œé‡ï¼Œé‚£é€™æœƒæœ‰å…©ç¨®æƒ…æ³\n ç„¡æ³•å–å¾—ä¸Šæ¬¡å‰©é¤˜çš„ä»¤ç‰Œé‡: å°‡ä¸Šæ¬¡å‰©é¤˜çš„ä»¤ç‰Œé‡è¨­ç‚º0ï¼Œä¸¦ä¸”å°‡ä¸Šæ¬¡æ›´æ–°æ™‚é–“è¨­ç‚ºç¾åœ¨æ™‚é–“æ¸›å»éæœŸæ™‚é–“(é€™æ¨£å‰›å¥½åœ¨ä¸‹ä¸€å€‹å‹•ä½œæœƒå°‡å…¶ä»¤ç‰Œæ¡¶è£œæ»¿) å¯ä»¥å–å¾—ä¸Šæ¬¡å‰©é¤˜çš„ä»¤ç‰Œé‡: å–å¾—ä¸Šæ¬¡ä»¤ç‰Œé‡å¾Œå†å–å¾—ä¸Šæ¬¡æ›´æ–°æ™‚é–“ï¼Œå¦‚æœç„¡æ³•å–å¾—ä¸Šæ¬¡æ›´æ–°æ™‚é–“çš„è©±ï¼Œé€šå¸¸æ˜¯timestampKeyéæœŸä½†valueKeyæ²’éæœŸï¼Œå› æ­¤éœ€è¦å›æ¨ä¸Šæ¬¡æ›´æ–°æ™‚é–“ï¼Œå…¶è¨ˆç®—æ–¹å¼ç‚º: ç¾åœ¨æ™‚é–“ - ((å‰©é¤˜ä»¤ç‰Œ / ä»¤ç‰Œæ¡¶æœ€å¤§é™åˆ¶) * æ™‚é–“å€æ®µ  -- feedbackToken: max((ç¾åœ¨æ™‚é–“ - éå»æ™‚é–“) / æ™‚é–“é–“éš” * æœ€å¤§é™åˆ¶æ•¸é‡, 0) local feedbackToken = math.max((currentTime - lastUpdateTime) / interval * limit, 0) local token = math.min(lastRemainToken + feedbackToken, limit) remainToken = token - batchSize if remainToken \u0026lt; 0 then rejected = true remainToken = token end if rejected == false then redis.call(\u0026#39;PSETEX\u0026#39;, valueKey, interval, remainToken) if feedbackToken \u0026gt; 0 or modified then redis.call(\u0026#39;PSETEX\u0026#39;, timestampKey, interval, currentTime) else redis.call(\u0026#39;PEXPIRE\u0026#39;, timestampKey, interval) end end return { rejected, remainToken } æ¥ä¸‹ä¾†è¦è¨ˆç®—å›é¥‹ä»¤ç‰Œï¼Œä¹Ÿå°±æ˜¯å¾ä¸Šæ¬¡å­˜å–æ™‚é–“åˆ°ç›®å‰æ™‚é–“ç´¯ç©çš„ä»¤ç‰Œé‡ï¼Œè¨ˆç®—å®Œå¾Œéœ€è¦åˆ¤æ–·ç•¶å‰ä»¤ç‰Œæœ‰æ²’æœ‰æ»¿å‡ºä»¤ç‰Œæ¡¶ï¼Œè‹¥æ»¿å‡ºå‰‡ä¸Ÿæ£„ä»¤ç‰Œã€‚\nè¨ˆç®—å®Œç•¶å‰ä»¤ç‰Œå‰©é¤˜æ•¸é‡å¾Œåˆ¤æ–·æ¸›å»batchSizeå¾Œæ˜¯å¦é‚„å¤§æ–¼ç­‰æ–¼0ï¼Œè‹¥å°æ–¼0ä»£è¡¨æ‹’çµ•é€™æ­¤è«‹æ±‚ï¼Œæœ€å¾Œå†è¨­ç½®ç•¶å‰å‰©é¤˜ä»¤ç‰Œæ•¸é‡åŠå…¶éæœŸæ™‚é–“åŠå»¶é•·/è¨­ç½®ä¸Šæ¬¡æ›´æ–°æ™‚é–“åŠå…¶éæœŸæ™‚é–“ã€‚\næ¸¬è©¦çµæœ æœ€å¾Œé™„ä¸Šæ¸¬è©¦çµæœ(ä½¿ç”¨apache bench): å¯ä»¥çœ‹åˆ°å‚³é€äº†1200å€‹Requestï¼Œåƒ…æœ‰1000å€‹è«‹æ±‚è¢«å…è¨±(å‰©é¤˜200å€‹å…¨éƒ½æ‹‹å‡º429 Too Many Request)ã€‚\n","permalink":"https://yurepo.tw/2021/03/golang-redis-ratelimiter/","summary":"ä»¤ç‰Œæ¡¶æ¼”ç®—æ³•å¯¦ç¾ å‰è¨€ é€™å¹¾å¤©å°‡ä»¤ç‰Œæ¡¶é™æµæ¼”ç®—æ³•ä½¿ç”¨gin + rediså¯¦ç¾äº†ï¼Œä»Šå¤©ä¸»è¦è¦ä¾†è¬›æ•´å€‹é™æµéç¨‹æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚\nGithubé€£çµ\nä¸»è¦å®šç¾©äº†å››å€‹æ–‡ä»¶\n   æ–‡ä»¶å æè¿°     dto.go å®šç¾©åŠå®£å‘ŠRatelimiterçš„åŸºæœ¬çµæ§‹èˆ‡æ ¸å¿ƒTake()æ–¹æ³•   err.go å®šç¾©äº†ä¸€äº›éŒ¯èª¤   ratelimiter.go å­˜æ”¾gin middlewareä¸­é©—è­‰çš„é‚è¼¯   script.go å­˜æ”¾ lua è…³æœ¬åŠ lua è…³æœ¬ä¸­è¼¸å…¥è®Šæ•¸çš„çµæ§‹    æˆ‘å€‘æœƒå°‡ä¸Šæ¬¡æ›´æ–°çš„æ™‚é–“èˆ‡å‰©é¤˜ä»¤ç‰Œçš„æ•¸é‡å„²å­˜åœ¨Redisä¸­ï¼Œè€Œä¸»è¦æ›´æ–°çš„é‚è¼¯æœƒå¯«åœ¨script.goï¼Œé€™è£¡æœƒç™¼ç¾æ•´å€‹æ“ä½œRedisè³‡æ–™åº«çš„é‚è¼¯æ˜¯ä½¿ç”¨lua scriptå»å¯¦ä½œçš„ï¼ŒæŠŠå¤šå€‹æ“ä½œRedisçš„æŒ‡ä»¤åŒ…åœ¨lua scriptä¸­ï¼ŒRedisæœƒä¿è­‰lua scriptä¸­çš„å¤šå€‹æ“ä½œæœƒä»¥Atomicçš„æ–¹å¼é€²è¡Œï¼Œé€™æ¨£æ‰å¯ä»¥ä¿è­‰æ¯å€‹æ“ä½œä¹‹é–“ä¸æœƒæœ‰ç«¶çˆ­æƒ…æ³(Race Condition)ç™¼ç”Ÿã€‚ åƒè€ƒè³‡æ–™\nç¨‹å¼ç¢¼éƒ¨åˆ† Golang æ¥ä¸‹ä¾†å°±é€²å…¥åˆ°ç¨‹å¼ç¢¼çš„éƒ¨åˆ† é¦–å…ˆæˆ‘å®šç¾©äº† RedisRateLimiter çµæ§‹\ndto.go\ntype RedisRateLimiter struct { context context.Context scriptSHA1 string client *redis.Client } é€™é‚Šå°‡RedisRateLimiterçš„ä¸€äº›å¿…é ˆç”¨åˆ°çš„è®Šæ•¸åŒ…è£èµ·ä¾†ï¼ŒåŒ…è£çš„è®Šæ•¸å‹åˆ¥åŒ…å«äº†Rediså®¢æˆ¶ç«¯ã€LUA Script SHA1(å¾ŒçºŒæœƒä½¿ç”¨evalshaèª¿ç”¨å·²ç¶“è®€é€²Redisè…³æœ¬ç·©å­˜çš„Lua script)ã€Goroutine contextã€‚\né€™å€‹Repositoryå¯¦ç¾çš„æ¼”ç®—æ³•æ˜¯Token Bucketæ¼”ç®—æ³•ï¼Œä¸éä¹Ÿå¯ä»¥åˆ©ç”¨ä¸Šè¿°å®šç¾©çš„çµæ§‹å»å¯¦ç¾ä¸åŒç®—æ³•ï¼Œä¾‹å¦‚ï¼šLeaky Bucketã€‚","title":"Golang Redis Ratelimiter"},{"content":"ä¸Šå›æˆ‘å€‘èªªäº†SecurityContextHolderä¸»è¦åœ¨åšä»€éº¼ï¼Œé€™å›ä¸»è¦è¨è«–çš„æ˜¯ï¼ŒSecurityContextåˆ°åº•æ˜¯ä½•æ–¹ç¥è–ï¼Œå®ƒå¾ä½•è€Œä¾†ã€‚\nSecurityContextå®ƒä½œç‚º Spring Security æ ¸å¿ƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„ä½œç”¨å¯èªªæ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘å€‘ä¾†çœ‹çœ‹SecurityContextçš„æºç¢¼ã€‚\npublic interface SecurityContext extends Serializable { /** * ç²å–ç•¶å‰å·²é©—è­‰çš„èº«åˆ†æˆ–é©—è­‰è«‹æ±‚ä»¤ç‰Œ * * @return the \u0026lt;code\u0026gt;Authentication\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;null\u0026lt;/code\u0026gt; if no authentication * information is available */ Authentication getAuthentication(); /** * æ”¹è®Šç›®å‰å·²é©—è­‰çš„èº«åˆ†æˆ–åˆªé™¤é©—è­‰è³‡æ–™ * * @param authentication the new \u0026lt;code\u0026gt;Authentication\u0026lt;/code\u0026gt; token, or * \u0026lt;code\u0026gt;null\u0026lt;/code\u0026gt; if no further authentication information should be stored */ void setAuthentication(Authentication authentication); } å¯ä»¥çœ‹åˆ°SecurityContextä¸»è¦æ˜¯åœ¨ç®¡ç†Authenticationçš„ç‰©ä»¶ï¼Œé‚£é€™å€‹Authenticationä¸»è¦æ˜¯å­˜æ”¾ç•¶å‰ä½¿ç”¨è€…çš„èº«åˆ†(å»¢è©±)ã€å­˜æ”¾æ˜¯å¦å·²é©—è­‰ä»¥åŠå–å¾—ç›®å‰ä½¿ç”¨è€…æ“æœ‰çš„æ¬Šé™ã€‚\né‚£ SecurityContext å¾ä½•è€Œä¾†å‘¢? åŒå€‹åŒ…å…§çš„SecurityContextImplå°±æ˜¯å®ƒçš„å¯¦ç¾ï¼Œè£¡é¢éƒ½æ˜¯å¾ˆåŸºæœ¬çš„é‚è¼¯ï¼Œé€™æ¬¡å°±ä¸æ”¾äº†ï¼Œå¯å¾å®˜æ–¹GitHubæ‰¾åˆ°ç›¸é—œæºä»£ç¢¼ã€‚\né‚£å¦‚ä½•åœ¨ä¸åŒrequestä¹‹é–“ä¿å­˜SecurityContextå‘¢? åœ¨Spring Securityä¸»è¦æœ‰å…©å€‹åœ¨ä¸åŒrequestä¹‹é–“ä¿å­˜SecurityContextçš„ç­–ç•¥ï¼Œé€™é‚Šç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼Œå…©è€…éƒ½æ˜¯ServerSecurityContextRepositoryçš„å¯¦ç¾ã€‚\n NoOpServerSecurityContextRepository: å¾ˆå»¢ï¼Œç•¶ä½ å«å®ƒä¿å­˜çš„æ™‚å€™å®ƒä¸æœƒç†ä½ ï¼Œå·¦è€³é€²å³è€³å‡ºï¼Œç„¶å¾Œä½ å•ä»–é‚£å€‹æ±è¥¿åœ¨å“ªï¼Œå®ƒæœƒç›´æ¥èªª\u0026quot;æˆ‘ä¸çŸ¥é“ï¼Œä½ æœ‰è·Ÿæˆ‘è¬›éå—?\u0026quot;ï¼Œé€šå¸¸ç”¨æ–¼ç„¡ç‹€æ…‹(Stateless)é©—è­‰ï¼Œä¾‹å¦‚ï¼šhttpBasicã€‚ WebSessionServerSecurityContextRepository: å¥½å­¸ç”Ÿï¼Œä½ å«å®ƒä¿å­˜çš„æ™‚å€™ï¼Œå®ƒæœƒå¹«ä½ åšä¸‰ä»¶äº‹ï¼Œ1. å–å¾—ç•¶å‰Session -\u0026gt; 2. å¹«ä½ æŠŠæ±è¥¿ä¿å­˜è‡³Session -\u0026gt; 3. é †ä¾¿å¹«ä½ æŠŠSessionIdæ›æˆæ–°çš„ã€‚é€šå¸¸ç”¨æ–¼formLoginã€‚  é›–ç„¶ç¬¬äºŒç¨®æ–¹æ³•éå¸¸ç†æƒ³ï¼Œå¯æ˜¯è¦çŸ¥é“å„²å­˜æ˜¯éå¸¸æ˜‚è²´çš„ä¸€ä»¶äº‹ï¼Œæ‰€ä»¥åœ¨InMemoryWebSessionStoreæœ‰å®šç¾©èªªï¼ŒSessioné è¨­å°±åªèƒ½æœ‰10000å€‹ï¼Œå†å¤šå®ƒå°±æœƒè·Ÿä½ é¬§è„¾æ°£(ä¸ŸéŒ¯èª¤)ã€‚ ç•¶ç„¶ä½ å¯ä»¥æ”¹è®Šé è¨­å€¼ä½¿å…¶é”åˆ°ä½ é ä¼°çš„æ•¸é‡ï¼Œä½†æœ€å¥½çš„è§£æ±ºæ–¹æ³•æ˜¯è‡ªå®šç¾©ä½ çš„WebSessionStoreç”¨ä»¥æ”¯æŒæ›´å¤šSessionã€‚(åœ¨DefaultWebSessionManagerå¯è¨­ç½®æ‚¨çš„è‡ªå®šç¾©WebSessionStore)ã€‚\né€™å›æˆ‘å€‘ç°¡å–®ä»‹ç´¹äº†SecurityContextä»¥åŠæäº†ä¸€äº›ç›¸é—œçš„APIï¼Œä¸‹å›é è¨ˆä»‹ç´¹å„ç¨®Filtersã€‚\n","permalink":"https://yurepo.tw/2020/10/spring-security-02-security-context-%E5%BE%9E%E5%93%AA%E4%BE%86/","summary":"ä¸Šå›æˆ‘å€‘èªªäº†SecurityContextHolderä¸»è¦åœ¨åšä»€éº¼ï¼Œé€™å›ä¸»è¦è¨è«–çš„æ˜¯ï¼ŒSecurityContextåˆ°åº•æ˜¯ä½•æ–¹ç¥è–ï¼Œå®ƒå¾ä½•è€Œä¾†ã€‚\nSecurityContextå®ƒä½œç‚º Spring Security æ ¸å¿ƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„ä½œç”¨å¯èªªæ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘å€‘ä¾†çœ‹çœ‹SecurityContextçš„æºç¢¼ã€‚\npublic interface SecurityContext extends Serializable { /** * ç²å–ç•¶å‰å·²é©—è­‰çš„èº«åˆ†æˆ–é©—è­‰è«‹æ±‚ä»¤ç‰Œ * * @return the \u0026lt;code\u0026gt;Authentication\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;null\u0026lt;/code\u0026gt; if no authentication * information is available */ Authentication getAuthentication(); /** * æ”¹è®Šç›®å‰å·²é©—è­‰çš„èº«åˆ†æˆ–åˆªé™¤é©—è­‰è³‡æ–™ * * @param authentication the new \u0026lt;code\u0026gt;Authentication\u0026lt;/code\u0026gt; token, or * \u0026lt;code\u0026gt;null\u0026lt;/code\u0026gt; if no further authentication information should be stored */ void setAuthentication(Authentication authentication); } å¯ä»¥çœ‹åˆ°SecurityContextä¸»è¦æ˜¯åœ¨ç®¡ç†Authenticationçš„ç‰©ä»¶ï¼Œé‚£é€™å€‹Authenticationä¸»è¦æ˜¯å­˜æ”¾ç•¶å‰ä½¿ç”¨è€…çš„èº«åˆ†(å»¢è©±)ã€å­˜æ”¾æ˜¯å¦å·²é©—è­‰ä»¥åŠå–å¾—ç›®å‰ä½¿ç”¨è€…æ“æœ‰çš„æ¬Šé™ã€‚\né‚£ SecurityContext å¾ä½•è€Œä¾†å‘¢? åŒå€‹åŒ…å…§çš„SecurityContextImplå°±æ˜¯å®ƒçš„å¯¦ç¾ï¼Œè£¡é¢éƒ½æ˜¯å¾ˆåŸºæœ¬çš„é‚è¼¯ï¼Œé€™æ¬¡å°±ä¸æ”¾äº†ï¼Œå¯å¾å®˜æ–¹GitHubæ‰¾åˆ°ç›¸é—œæºä»£ç¢¼ã€‚\né‚£å¦‚ä½•åœ¨ä¸åŒrequestä¹‹é–“ä¿å­˜SecurityContextå‘¢? åœ¨Spring Securityä¸»è¦æœ‰å…©å€‹åœ¨ä¸åŒrequestä¹‹é–“ä¿å­˜SecurityContextçš„ç­–ç•¥ï¼Œé€™é‚Šç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼Œå…©è€…éƒ½æ˜¯ServerSecurityContextRepositoryçš„å¯¦ç¾ã€‚\n NoOpServerSecurityContextRepository: å¾ˆå»¢ï¼Œç•¶ä½ å«å®ƒä¿å­˜çš„æ™‚å€™å®ƒä¸æœƒç†ä½ ï¼Œå·¦è€³é€²å³è€³å‡ºï¼Œç„¶å¾Œä½ å•ä»–é‚£å€‹æ±è¥¿åœ¨å“ªï¼Œå®ƒæœƒç›´æ¥èªª\u0026quot;æˆ‘ä¸çŸ¥é“ï¼Œä½ æœ‰è·Ÿæˆ‘è¬›éå—?\u0026quot;ï¼Œé€šå¸¸ç”¨æ–¼ç„¡ç‹€æ…‹(Stateless)é©—è­‰ï¼Œä¾‹å¦‚ï¼šhttpBasicã€‚ WebSessionServerSecurityContextRepository: å¥½å­¸ç”Ÿï¼Œä½ å«å®ƒä¿å­˜çš„æ™‚å€™ï¼Œå®ƒæœƒå¹«ä½ åšä¸‰ä»¶äº‹ï¼Œ1.","title":"Spring Security 02 - Security Context? å¾å“ªä¾†?"},{"content":"Spring Securityå°æ–¼å¯«éSpring Bootçš„äººæ‡‰è©²æ˜¯å†ç†Ÿæ‚‰ä¸éäº†ï¼Œé€™ç¯‡æ–‡ä¸»è¦ç´€éŒ„æˆ‘å°æ–¼ ReactiveSecurityContextHolderçš„ç†è§£ï¼ŒåŸå§‹ç¢¼ç‰ˆæœ¬ç‚º5.4.0-RC1ã€‚\nåœ¨èŠåŸå§‹ç¢¼å‰ï¼Œæˆ‘æƒ³å…ˆèŠä¸€ä¸‹Contextåˆ°åº•æ˜¯ä»€éº¼ã€‚\nContextï¼Œä¸­æ–‡è­¯ä½œã€Œä¸Šä¸‹æ–‡ã€ï¼Œæˆ‘å°æ–¼ä¸Šä¸‹æ–‡çš„ç†è§£å°±æ˜¯ç‰©ä»¶ä½œç”¨çš„ç’°å¢ƒã€‚\næ‰“å€‹æ¯”æ–¹ï¼Œå‡è¨­ç¾åœ¨æœ‰ä¸€å€‹ç‰©ä»¶å«åšWeatherï¼Œè€Œå‡è¨­Weatherç‰©ä»¶æœƒæœ‰ä¸‹é›¨ã€æ™´æœ—é€™å…©ç¨®ç‹€æ…‹ï¼Œä¸”EarthContextå°è£å…¶ç‰©ä»¶æˆ–è€…æ˜¯å¼·åˆ¶å…¶æ”¹è®Šç‚ºæŸç¨®ç‹€æ…‹æ™‚ï¼Œå‰‡å¯ä»¥èªªWeatherçš„ä¸Šä¸‹æ–‡æ˜¯EarthContextã€‚\nå°æ–¼Spring Securityä¾†èªªï¼ŒSecurityContextå°±æ˜¯æ•´å€‹Spring Securityæ‡‰ç”¨çš„ä¸Šä¸‹æ–‡ã€‚\nè€ŒSecurityContextHolderå°±æ˜¯å–®ç´”ä¿å­˜é€™å€‹ä¸Šä¸‹æ–‡è€Œå­˜åœ¨çš„ã€‚ åœ¨å‚³çµ±Servletæ‡‰ç”¨SecurityContextHolderæ˜¯å­˜åœ¨å¤šç¨®ä¿å­˜ä¸Šä¸‹æ–‡çš„ç­–ç•¥ï¼Œæ¯”æ–¹èªªGlobalSecurityContextHolderStrategyã€InheritableThreadLocalSecurityContextHolderStrategyè·ŸThreadLocalSecurityContextHolderStrategyï¼Œä½†åœ¨ReactiveSecurityContextHolderä¸­ï¼Œä¸¦æ²’æœ‰å¤šç¨®ç­–ç•¥å»ä¿å­˜SecurityContextï¼Œå”¯ä¸€ä¿å­˜ä¸Šä¸‹æ–‡çš„æ–¹æ³•å°±æ˜¯é€éReactorçš„ä¸Šä¸‹æ–‡ã€‚\nä»¥ä¸‹ç‚ºå€‹äººéƒ¨åˆ†ç¿»è­¯çš„æºç¢¼ï¼š\npublic class ReactiveSecurityContextHolder { private static final Class\u0026lt;?\u0026gt; SECURITY_CONTEXT_KEY = SecurityContext.class; /** * å¾ Reactor {@link Context} å–å¾— {@code Mono\u0026lt;SecurityContext\u0026gt;} * @return å›å‚³ {@code Mono\u0026lt;SecurityContext\u0026gt;} */ public static Mono\u0026lt;SecurityContext\u0026gt; getContext() { // å¾Reactorçš„ä¸Šä¸‹æ–‡ä¸­å–å¾—SecurityContext \treturn Mono.subscriberContext() .filter( c -\u0026gt; c.hasKey(SECURITY_CONTEXT_KEY)) .flatMap( c-\u0026gt; c.\u0026lt;Mono\u0026lt;SecurityContext\u0026gt;\u0026gt;get(SECURITY_CONTEXT_KEY)); } /** * å¾ Reactor {@link Context} æ¸…é™¤ {@code Mono\u0026lt;SecurityContext\u0026gt;} * @return æ¸…é™¤Reactorä¸Šä¸‹æ–‡ï¼Œä¸¦å›å‚³ä¸€å€‹ Mono\u0026lt;Void\u0026gt;ï¼Œè‹¥æ¸…é™¤å¤±æ•—ï¼Œå‰‡å ±éŒ¯ã€‚ */ public static Function\u0026lt;Context, Context\u0026gt; clearContext() { // å¾Reactorçš„ä¸Šä¸‹æ–‡ä¸­åˆªé™¤SecurityContext \treturn context -\u0026gt; context.delete(SECURITY_CONTEXT_KEY); } /** * å‰µå»ºå«æœ‰ {@code Mono\u0026lt;SecurityContext\u0026gt;} çš„ Reactor {@link Context} * å¯èˆ‡å…¶ä»– {@link Context} åˆä½µ * @param securityContext the {@code Mono\u0026lt;SecurityContext\u0026gt;} to set in the returned * Reactor {@link Context} * @return a Reactor {@link Context} that contains the {@code Mono\u0026lt;SecurityContext\u0026gt;} */ public static Context withSecurityContext(Mono\u0026lt;? extends SecurityContext\u0026gt; securityContext) { return Context.of(SECURITY_CONTEXT_KEY, securityContext); } /** * A shortcut for {@link #withSecurityContext(Mono)} * @param authentication the {@link Authentication} to be used * @return a Reactor {@link Context} that contains the {@code Mono\u0026lt;SecurityContext\u0026gt;} */ public static Context withAuthentication(Authentication authentication) { return withSecurityContext(Mono.just(new SecurityContextImpl(authentication))); } } äº†è§£äº† ReactiveSecurityContextHolder ä¸»è¦åœ¨å¹¹å˜›ï¼Œä¸‹ä¸€ç¯‡é è¨ˆæœƒä»‹ç´¹ SecurityContext å¾ä½•è€Œä¾†ã€‚\n","permalink":"https://yurepo.tw/2020/10/spring-security-01-%E9%97%9C%E6%96%BC-reactivesecuritycontextholder-%E7%9A%84%E4%B8%80%E5%85%A9%E4%BB%B6%E4%BA%8B/","summary":"Spring Securityå°æ–¼å¯«éSpring Bootçš„äººæ‡‰è©²æ˜¯å†ç†Ÿæ‚‰ä¸éäº†ï¼Œé€™ç¯‡æ–‡ä¸»è¦ç´€éŒ„æˆ‘å°æ–¼ ReactiveSecurityContextHolderçš„ç†è§£ï¼ŒåŸå§‹ç¢¼ç‰ˆæœ¬ç‚º5.4.0-RC1ã€‚\nåœ¨èŠåŸå§‹ç¢¼å‰ï¼Œæˆ‘æƒ³å…ˆèŠä¸€ä¸‹Contextåˆ°åº•æ˜¯ä»€éº¼ã€‚\nContextï¼Œä¸­æ–‡è­¯ä½œã€Œä¸Šä¸‹æ–‡ã€ï¼Œæˆ‘å°æ–¼ä¸Šä¸‹æ–‡çš„ç†è§£å°±æ˜¯ç‰©ä»¶ä½œç”¨çš„ç’°å¢ƒã€‚\næ‰“å€‹æ¯”æ–¹ï¼Œå‡è¨­ç¾åœ¨æœ‰ä¸€å€‹ç‰©ä»¶å«åšWeatherï¼Œè€Œå‡è¨­Weatherç‰©ä»¶æœƒæœ‰ä¸‹é›¨ã€æ™´æœ—é€™å…©ç¨®ç‹€æ…‹ï¼Œä¸”EarthContextå°è£å…¶ç‰©ä»¶æˆ–è€…æ˜¯å¼·åˆ¶å…¶æ”¹è®Šç‚ºæŸç¨®ç‹€æ…‹æ™‚ï¼Œå‰‡å¯ä»¥èªªWeatherçš„ä¸Šä¸‹æ–‡æ˜¯EarthContextã€‚\nå°æ–¼Spring Securityä¾†èªªï¼ŒSecurityContextå°±æ˜¯æ•´å€‹Spring Securityæ‡‰ç”¨çš„ä¸Šä¸‹æ–‡ã€‚\nè€ŒSecurityContextHolderå°±æ˜¯å–®ç´”ä¿å­˜é€™å€‹ä¸Šä¸‹æ–‡è€Œå­˜åœ¨çš„ã€‚ åœ¨å‚³çµ±Servletæ‡‰ç”¨SecurityContextHolderæ˜¯å­˜åœ¨å¤šç¨®ä¿å­˜ä¸Šä¸‹æ–‡çš„ç­–ç•¥ï¼Œæ¯”æ–¹èªªGlobalSecurityContextHolderStrategyã€InheritableThreadLocalSecurityContextHolderStrategyè·ŸThreadLocalSecurityContextHolderStrategyï¼Œä½†åœ¨ReactiveSecurityContextHolderä¸­ï¼Œä¸¦æ²’æœ‰å¤šç¨®ç­–ç•¥å»ä¿å­˜SecurityContextï¼Œå”¯ä¸€ä¿å­˜ä¸Šä¸‹æ–‡çš„æ–¹æ³•å°±æ˜¯é€éReactorçš„ä¸Šä¸‹æ–‡ã€‚\nä»¥ä¸‹ç‚ºå€‹äººéƒ¨åˆ†ç¿»è­¯çš„æºç¢¼ï¼š\npublic class ReactiveSecurityContextHolder { private static final Class\u0026lt;?\u0026gt; SECURITY_CONTEXT_KEY = SecurityContext.class; /** * å¾ Reactor {@link Context} å–å¾— {@code Mono\u0026lt;SecurityContext\u0026gt;} * @return å›å‚³ {@code Mono\u0026lt;SecurityContext\u0026gt;} */ public static Mono\u0026lt;SecurityContext\u0026gt; getContext() { // å¾Reactorçš„ä¸Šä¸‹æ–‡ä¸­å–å¾—SecurityContext \treturn Mono.subscriberContext() .filter( c -\u0026gt; c.hasKey(SECURITY_CONTEXT_KEY)) .flatMap( c-\u0026gt; c.\u0026lt;Mono\u0026lt;SecurityContext\u0026gt;\u0026gt;get(SECURITY_CONTEXT_KEY)); } /** * å¾ Reactor {@link Context} æ¸…é™¤ {@code Mono\u0026lt;SecurityContext\u0026gt;} * @return æ¸…é™¤Reactorä¸Šä¸‹æ–‡ï¼Œä¸¦å›å‚³ä¸€å€‹ Mono\u0026lt;Void\u0026gt;ï¼Œè‹¥æ¸…é™¤å¤±æ•—ï¼Œå‰‡å ±éŒ¯ã€‚ */ public static Function\u0026lt;Context, Context\u0026gt; clearContext() { // å¾Reactorçš„ä¸Šä¸‹æ–‡ä¸­åˆªé™¤SecurityContext \treturn context -\u0026gt; context.","title":"Spring Security 01 - é—œæ–¼ ReactiveSecurityContextHolder çš„ä¸€å…©ä»¶äº‹"},{"content":"ä½¿ç”¨Spring WebFluxä¿è­·æ‚¨çš„ç¶²ç«™æ‡‰ç”¨(é©—è­‰ç¯‡) ç›¸ä¿¡ç€è¦½åˆ°é€™å€‹Topicçš„å„ä½ä¸€å®šéƒ½å° Reactive æœ‰ç›¸ç•¶çš„èªè­˜äº†ï¼Œæœ¬æ–‡ç« å°‡å°ˆæ³¨åœ¨è¬›è§£ WebFlux \u0026amp; Reactive Securityçš„æ‡‰ç”¨é–‹ç™¼ï¼Œå…¶é¤˜åŸºç¤ä¾¿ä¸å†è´…è¿°ã€‚\né¦–å…ˆæˆ‘å€‘éœ€è¦åˆ° Spring Initializr ç”¢ç”Ÿæˆ‘å€‘çš„Spring WebFlux Applicationã€‚\næœ¬æ–‡ç« éœ€è¦çš„ä¾è³´æœ‰ï¼šSpring Reactive Webã€Spring Securityã€Spring Configuration Processor(å¯é¸) *æ–‡ç« æ’°å¯«æ™‚ Spring ç‰ˆæœ¬ç‚º 2.4.0(M2)ï¼Œä¾æ“šç‰ˆæœ¬æ›´æ–°æœ‰äº›åœ°æ–¹æœƒç¨ç¨ä¸åŒã€‚ æ¥ä¸‹ä¾†ä½¿ç”¨æ‚¨å–œæ­¡çš„IDEå»åšé–‹ç™¼ï¼Œæœ¬æ–‡å°‡ä½¿ç”¨Intellij IDEAé–‹ç™¼\nå‰ç½®æº–å‚™ é¦–å…ˆå…ˆæ·»åŠ Jwtçš„ä¾è³´ï¼Œæˆ‘å€‘æœƒæ–¼ç¨å¾Œç”¨åˆ°ã€‚(é€™éƒ¨åˆ†æ¡ç”¨æ‚¨ç†Ÿæ‚‰çš„å·¥å…·ä¹Ÿè¡Œï¼Œä¹Ÿä¸ä¸€å®šéœ€è¦ç”¨Jwtï¼ŒPASETOä¹Ÿæ˜¯ä¸éŒ¯çš„é¸æ“‡)\ndependencies { // jwt dependency implementation(\u0026quot;com.auth0:java-jwt:3.10.3\u0026quot;) // other depencies ... } è¨­å®šç¶²ç«™ç«¯é» é€™éƒ¨åˆ†æˆ‘å€‘éœ€è¦é…ç½®Spring Securityï¼Œèˆ‡ä»¥å¾€çš„Servletæ‡‰ç”¨ä¸åŒï¼Œä¸èƒ½ç›´æ¥ç¹¼æ‰¿WebSecurityConfigurerAdapterå»åšè¨­å®šã€‚ é¦–å…ˆï¼Œåœ¨å°ˆæ¡ˆåº•ä¸‹æ–°å¢ä¸€Packageauthï¼ŒæŠŠæ‰€æœ‰é©—è­‰ã€æˆæ¬Šé‚è¼¯æ”¾åœ¨é€™ã€‚ åœ¨authè³‡æ–™å¤¾åº•ä¸‹å†æ–°å¢ä¸€å€‹Packageconfigï¼Œæ¨™ç¤ºå…¶ç‚ºè¨­å®šæª”æ‰€åœ¨ä½ç½®ã€‚ åœ¨configåº•ä¸‹æ–°å¢ä¸€é¡åˆ¥ç¨±ä½œAuthSecurityConfigã€‚ åœ¨AuthSecurityConfigæ–°å¢ä»¥ä¸‹ç¨‹å¼ç¢¼è¦åŠƒç¶²ç«™æˆæ¬Šçš„Endpoints\n@Bean fun authRoute(http: ServerHttpSecurity): SecurityWebFilterChain { return http { // csrf é—œé–‰ï¼Œæ–¹ä¾¿æ¸¬è©¦  csrf { disable() } // åªç¯©é¸/authé–‹é ­çš„è·¯å¾‘  securityMatcher(PathPatternParserServerWebExchangeMatcher(\u0026#34;/auth/**\u0026#34;)) // è¦åŠƒEndpoints  authorizeExchange { authorize(\u0026#34;/auth/login\u0026#34;, permitAll) authorize(\u0026#34;/auth/me\u0026#34;, authenticated) authorize(anyExchange, authenticated) } // é—œé–‰ formLoginè·ŸHttpBasic  formLogin { disable() } httpBasic { disable() } } } è¦åŠƒå®Œå¾Œè¦æ€è€ƒä¸€ä»¶äº‹æƒ…ï¼Œã€è¦å¦‚ä½•é©—è­‰ä½¿ç”¨è€…å‚³ä¾†çš„è³‡è¨Š?ã€‘ï¼Œé€™æ™‚å€™AuthenticationWebFilterå°±æ´¾ä¸Šç”¨å ´äº†ï¼Œä½¿ç”¨è€…å‚³Requesté€²ä¾†å¾Œæœƒç¶“éå±¤å±¤çš„éæ¿¾å™¨ï¼Œé€™å€‹çµæ§‹ç¨±ç‚ºFilterChainï¼Œé‚£éˆç‹€çµæ§‹å°±æœ‰ä¸€å€‹ç‰¹è‰²ï¼Œå°±æ˜¯æœƒä¾åºå»ç¯©é¸Requestï¼Œæœ€å¾Œé€šéå±¤å±¤éæ¿¾å™¨çš„Requestæ‰æœƒåˆ°é”æˆ‘å€‘çš„Controllerï¼ŒAuthenticationWebFilteræ˜¯SecurityFilterChainçš„å…¶ä¸­ä¸€ç’°ï¼Œä½†æœªåœ¨ Spring Security Reference Docs æœ‰è©³ç´°ä»‹ç´¹ã€‚\nå»ºç«‹AuthenticationManager åœ¨å»ºç«‹AuthenticationFilterå‰ï¼Œæˆ‘å€‘éœ€è¦èƒ½å¤ é›†ä¸­ç®¡ç†æˆæ¬Šçš„ç®¡ç†è€…ï¼Œåœ¨Spring Securityè£¡è¢«ç¨±ç‚ºAuthenticationManagerï¼ŒåŒæ™‚æˆ‘å€‘ä¹Ÿéœ€è¦UserDetailServiceæ‰èƒ½å»åˆå§‹åŒ–AuthenticationManangerï¼Œé€™é‚Šæ¡ç”¨MapReactiveUserDetailsServiceç•¶ä½œç¯„ä¾‹ï¼Œå¯¦å‹™é–‹ç™¼ä¸Šè«‹ä¸²æ¥MongoDBã€MySQLç­‰ç­‰çš„è³‡æ–™åº«ã€‚\n@Bean @Qualifier(\u0026#34;AuthUserService\u0026#34;) fun UserService(): MapReactiveUserDetailsService { val user = User.withDefaultPasswordEncoder() .username(\u0026#34;user\u0026#34;) .password(\u0026#34;pass\u0026#34;) .roles(\u0026#34;USER\u0026#34;) .build() return MapReactiveUserDetailsService(user) } @Bean fun AuthManager( @Qualifier(\u0026#34;AuthUserService\u0026#34;) service: MapReactiveUserDetailsService ): UserDetailsRepositoryReactiveAuthenticationManager { return UserDetailsRepositoryReactiveAuthenticationManager(service) } å»ºç«‹ç¬¬ä¸€å€‹AuthenticationWebFilter å‰ç½®æº–å‚™éƒ½å¼„å¥½äº†ï¼Œæ¥ä¸‹ä¾†å°±è¦å»ºç«‹ç¬¬ä¸€å€‹AuthenticationWebFilterï¼ŒAuthenticationWebFilterå·²ç¶“å¯¦ç¾äº†åŸºç¤çš„é©—è­‰ï¼Œæ•…æˆ‘å€‘åªéœ€è¦ç¨ä½œä¿®æ”¹å³å¯ä»¥ä½¿ç”¨ã€‚ é€™é‚Šæˆ‘å€‘æœƒå°‡DataBufferæ˜ å°„ç‚ºObjectï¼Œæ•…å°‡ä½¿ç”¨ObjectMapperï¼Œè«‹æ·»åŠ ä¾è³´ï¼š\ndependencies { // object mapper implementation(\u0026quot;com.fasterxml.jackson.module:jackson-module-kotlin\u0026quot;) // other depencies ... } ä»¥ä¸‹æ˜¯æœ¬äººå¯«çš„AuthenticationWebFilterçš„ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œä¸èƒ½å¤ ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿè«‹ä¸è¦ç›´æ¥ä½¿ç”¨ï¼Œæœƒæœ‰å®‰å…¨ä¸Šçš„ç–‘æ…®ã€‚ JwtServiceè«‹è‡ªè¡Œå¯¦ç¾\n@Qualifier(\u0026#34;Authentication\u0026#34;) @Bean fun AuthFilter(manager: UserDetailsRepositoryReactiveAuthenticationManager): AuthenticationWebFilter { // è¦è¢«é©—è­‰çš„ä½¿ç”¨è€…  var AuthUser: LogInRequest? = null val filter = AuthenticationWebFilter(manager) filter.setRequiresAuthenticationMatcher { ServerWebExchangeMatchers.pathMatchers(HttpMethod.POST, \u0026#34;/auth/login\u0026#34;).matches(it) } filter.setServerAuthenticationConverter {exchange -\u0026gt; exchange.request .body .next() .switchIfEmpty { Mono.defer { Mono.error\u0026lt;DataBuffer\u0026gt;(RequestBodyIsEmpty()) } } .flatMap { it.ToRead\u0026lt;LogInRequest\u0026gt;() } .filter { it.username != null \u0026amp;\u0026amp; it.password != null } .switchIfEmpty { Mono.defer { Mono.error\u0026lt;LogInRequest\u0026gt;(UserInfoError()) } } .map { user -\u0026gt; // å„²å­˜ä½¿ç”¨è€…è³‡è¨Šï¼Œä»¥ä¾¿é ’ç™¼Jwt  AuthUser = user UsernamePasswordAuthenticationToken(user.username, user.password) } } filter.setAuthenticationSuccessHandler { filters, auth -\u0026gt; val credential = AuthUser?.let { it.password } if (credential != null){ return@setAuthenticationSuccessHandler filters.exchange.response.let { it.headers.contentType = MediaType.APPLICATION_JSON it.statusCode = HttpStatus.OK it.writeJson(LogInResponse( token = \u0026#34;${JwtService.prefix}${JwtService.encrypt(auth.name, credential, auth.authorities)}\u0026#34;, expiredAt = JwtService.expireTime().format() )) } } else { return@setAuthenticationSuccessHandler filters.exchange.response.let { it.headers.contentType = MediaType.APPLICATION_JSON it.statusCode = HttpStatus.UNAUTHORIZED it.writeJson(FailResponse( message = \u0026#34;Illegal Arg.\u0026#34; )) } } } filter.setAuthenticationFailureHandler { filters, exception -\u0026gt; AuthUser = null return@setAuthenticationFailureHandler filters.exchange.response.let { it.statusCode = HttpStatus.UNAUTHORIZED it.headers.contentType = MediaType.APPLICATION_JSON it.writeJson(FailResponse(message = exception.message ?: \u0026#34;null\u0026#34;)) } } return filter } åŠ å…¥Filterè‡³SecurityConfig æˆ‘å€‘å‰›æ‰å®Œæˆäº†ç”¢ç”ŸJwtçš„Filterï¼Œç¾åœ¨å‰‡æ˜¯éœ€è¦åŠ å…¥Filterè‡³SecurityConfigè®“å…¶æˆç‚ºFilterChainçš„ä¸€ç’°ï¼Œé€™è£¡å› ç‚ºæˆ‘å€‘å¾Œé¢é‚„éœ€è¦æœ‰é©—è­‰Jwtçš„Filterï¼Œæ‰€ä»¥å°‡é€™å€‹éæ¿¾å™¨çš„æ¬¡åºè¨­ç‚ºHTTP_BASIC(æ¯”AUTHENTICATIONå‰é¢)\n@Bean fun authRoute(http: ServerHttpSecurity, @Qualifier(\u0026#34;Authentication\u0026#34;) AuthFilter: AuthenticationWebFilter ): SecurityWebFilterChain { return http { // csrf é—œé–‰ï¼Œæ–¹ä¾¿æ¸¬è©¦  csrf { disable() } // åªç¯©é¸/authé–‹é ­çš„è·¯å¾‘  securityMatcher(PathPatternParserServerWebExchangeMatcher(\u0026#34;/auth/**\u0026#34;)) // è¦åŠƒEndpoints  authorizeExchange { authorize(\u0026#34;/auth/login\u0026#34;, permitAll) authorize(\u0026#34;/auth/me\u0026#34;, authenticated) authorize(anyExchange, authenticated) } // é—œé–‰ formLoginè·ŸHttpBasic  formLogin { disable() } httpBasic { disable() } addFilterAt(AuthFilter, SecurityWebFiltersOrder.HTTP_BASIC) } } å»ºç«‹é©—è­‰Jwtçš„Filter èˆ‡å‰é¢å¤§åŒå°ç•°ï¼Œæ•…ç›´æ¥è²¼ä¸Šç¯„ä¾‹ä»£ç¢¼\n@Qualifier(\u0026#34;Validation\u0026#34;) @Bean fun ValidFilter(manager: UserDetailsRepositoryReactiveAuthenticationManager) : AuthenticationWebFilter{ val filter = AuthenticationWebFilter(manager) filter.setServerAuthenticationConverter { exchange -\u0026gt; Mono.just(exchange.request) .flatMap { JwtService.extract(it) } .flatMap { JwtService.parse(it) } .flatMap { JwtService.decrypt(it) } .flatMap { UsernamePasswordAuthBuilder.create(it) } .onErrorResume { exception -\u0026gt; log.info(\u0026#34;Jwt Service Authentication failed...\u0026#34;) Mono.empty\u0026lt;Authentication\u0026gt;() } } return filter } ä¸€æ¨£è¦å°‡FilteråŠ å…¥è‡³SecurityConfig\n@Bean fun authRoute(http: ServerHttpSecurity, @Qualifier(\u0026#34;Authentication\u0026#34;) AuthFilter: AuthenticationWebFilter, @Qualifier(\u0026#34;Validation\u0026#34;) ValidFilter: AuthenticationWebFilter ): SecurityWebFilterChain { return http { // csrf é—œé–‰ï¼Œæ–¹ä¾¿æ¸¬è©¦  csrf { disable() } // åªç¯©é¸/authé–‹é ­çš„è·¯å¾‘  securityMatcher(PathPatternParserServerWebExchangeMatcher(\u0026#34;/auth/**\u0026#34;)) // è¦åŠƒEndpoints  authorizeExchange { authorize(\u0026#34;/auth/login\u0026#34;, permitAll) authorize(\u0026#34;/auth/me\u0026#34;, authenticated) authorize(anyExchange, authenticated) } // é—œé–‰ formLoginè·ŸHttpBasic  formLogin { disable() } httpBasic { disable() } addFilterAt(AuthFilter, SecurityWebFiltersOrder.HTTP_BASIC) addFilterAt(ValidFilter, SecurityWebFiltersOrder.AUTHENTICATION) } } æœ€å¾Œåšä¸€ä¸‹å–®å…ƒæ¸¬è©¦å°±å¥½äº†ï¼Œlogoutçš„éƒ¨åˆ†æ‰¾æ™‚é–“å†åšèªªæ˜ï¼ŒåŸºæœ¬æ¦‚å¿µå°±æ˜¯è®“Jwt Tokenè¢«invalidateæ‰ï¼Œä½†é€™æ¨£å°±è¦ç‰½æ¶‰åˆ°è³‡æ–™åº«äº†ã€‚\n","permalink":"https://yurepo.tw/2020/09/spring-webflux-%E6%87%89%E7%94%A8%E9%96%8B%E7%99%BC/","summary":"ä½¿ç”¨Spring WebFluxä¿è­·æ‚¨çš„ç¶²ç«™æ‡‰ç”¨(é©—è­‰ç¯‡) ç›¸ä¿¡ç€è¦½åˆ°é€™å€‹Topicçš„å„ä½ä¸€å®šéƒ½å° Reactive æœ‰ç›¸ç•¶çš„èªè­˜äº†ï¼Œæœ¬æ–‡ç« å°‡å°ˆæ³¨åœ¨è¬›è§£ WebFlux \u0026amp; Reactive Securityçš„æ‡‰ç”¨é–‹ç™¼ï¼Œå…¶é¤˜åŸºç¤ä¾¿ä¸å†è´…è¿°ã€‚\né¦–å…ˆæˆ‘å€‘éœ€è¦åˆ° Spring Initializr ç”¢ç”Ÿæˆ‘å€‘çš„Spring WebFlux Applicationã€‚\næœ¬æ–‡ç« éœ€è¦çš„ä¾è³´æœ‰ï¼šSpring Reactive Webã€Spring Securityã€Spring Configuration Processor(å¯é¸) *æ–‡ç« æ’°å¯«æ™‚ Spring ç‰ˆæœ¬ç‚º 2.4.0(M2)ï¼Œä¾æ“šç‰ˆæœ¬æ›´æ–°æœ‰äº›åœ°æ–¹æœƒç¨ç¨ä¸åŒã€‚ æ¥ä¸‹ä¾†ä½¿ç”¨æ‚¨å–œæ­¡çš„IDEå»åšé–‹ç™¼ï¼Œæœ¬æ–‡å°‡ä½¿ç”¨Intellij IDEAé–‹ç™¼\nå‰ç½®æº–å‚™ é¦–å…ˆå…ˆæ·»åŠ Jwtçš„ä¾è³´ï¼Œæˆ‘å€‘æœƒæ–¼ç¨å¾Œç”¨åˆ°ã€‚(é€™éƒ¨åˆ†æ¡ç”¨æ‚¨ç†Ÿæ‚‰çš„å·¥å…·ä¹Ÿè¡Œï¼Œä¹Ÿä¸ä¸€å®šéœ€è¦ç”¨Jwtï¼ŒPASETOä¹Ÿæ˜¯ä¸éŒ¯çš„é¸æ“‡)\ndependencies { // jwt dependency implementation(\u0026quot;com.auth0:java-jwt:3.10.3\u0026quot;) // other depencies ... } è¨­å®šç¶²ç«™ç«¯é» é€™éƒ¨åˆ†æˆ‘å€‘éœ€è¦é…ç½®Spring Securityï¼Œèˆ‡ä»¥å¾€çš„Servletæ‡‰ç”¨ä¸åŒï¼Œä¸èƒ½ç›´æ¥ç¹¼æ‰¿WebSecurityConfigurerAdapterå»åšè¨­å®šã€‚ é¦–å…ˆï¼Œåœ¨å°ˆæ¡ˆåº•ä¸‹æ–°å¢ä¸€Packageauthï¼ŒæŠŠæ‰€æœ‰é©—è­‰ã€æˆæ¬Šé‚è¼¯æ”¾åœ¨é€™ã€‚ åœ¨authè³‡æ–™å¤¾åº•ä¸‹å†æ–°å¢ä¸€å€‹Packageconfigï¼Œæ¨™ç¤ºå…¶ç‚ºè¨­å®šæª”æ‰€åœ¨ä½ç½®ã€‚ åœ¨configåº•ä¸‹æ–°å¢ä¸€é¡åˆ¥ç¨±ä½œAuthSecurityConfigã€‚ åœ¨AuthSecurityConfigæ–°å¢ä»¥ä¸‹ç¨‹å¼ç¢¼è¦åŠƒç¶²ç«™æˆæ¬Šçš„Endpoints\n@Bean fun authRoute(http: ServerHttpSecurity): SecurityWebFilterChain { return http { // csrf é—œé–‰ï¼Œæ–¹ä¾¿æ¸¬è©¦  csrf { disable() } // åªç¯©é¸/authé–‹é ­çš„è·¯å¾‘  securityMatcher(PathPatternParserServerWebExchangeMatcher(\u0026#34;/auth/**\u0026#34;)) // è¦åŠƒEndpoints  authorizeExchange { authorize(\u0026#34;/auth/login\u0026#34;, permitAll) authorize(\u0026#34;/auth/me\u0026#34;, authenticated) authorize(anyExchange, authenticated) } // é—œé–‰ formLoginè·ŸHttpBasic  formLogin { disable() } httpBasic { disable() } } } è¦åŠƒå®Œå¾Œè¦æ€è€ƒä¸€ä»¶äº‹æƒ…ï¼Œã€è¦å¦‚ä½•é©—è­‰ä½¿ç”¨è€…å‚³ä¾†çš„è³‡è¨Š?","title":"Spring WebFlux æ‡‰ç”¨é–‹ç™¼"},{"content":"æ­Œæ›²é€£çµ[Youtube Music]\nã•ã‚ˆãªã‚‰ã‚’ç½®ã„ã¦åƒ•ã«èŠ±ã‚‚ãŸã› æ‹‹ä¸‹ä¸€å¥å†è¦‹å°±é›¢é–‹çš„å¦³ç‚ºæˆ‘ç•™ä¸‹äº†ä¸€æœµèŠ± è¦šæŸã¬ã¾ã¾ã«å¤œãŒæ˜ã‘ã¦ åœ¨æ²’æœ‰æ„è­˜çš„æƒ…æ³ä¸‹è¿ä¾†äº†é»æ˜ èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§èµ·ããŸ æ–¼ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡é†’ä¾†çš„æˆ‘ ãã®æ¸©ã‚‚ã‚Šä¸€ã¤æ®‹ã—ã¦ èº«æ—åƒ…æ®˜ç•™ä¸€çµ²æº«æš– æ˜¨æ—¥ã®å¤œã®ã“ã¨ã¯å°‘ã—ã‚‚è¦šãˆã¦ãªã„ã‘ã‚Œã© é›–ç„¶ä¸€é»ä¹Ÿè¨˜ä¸èµ·ä¾†æ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ… ä»–ã«èª°ã‹ãŒå±…ãŸã€ãã‚“ãªæ°—ãŒãŸã ã—ã¦ã„ã‚‹ ä¹Ÿåªæ˜¯æ„Ÿè¦ºæ˜¨æ™šä¼¼ä¹é‚„æœ‰èª°åœ¨çš„æ¨£å­ äºŒæ—¥é…”ã„ãŒæ®‹ã‚‹é ­ã¯å›ã£ã¡ã‚ƒã„ãªã„ã‘ã‚Œã© é›–ç„¶è…¦è¢‹é‚„å› ç‚ºå®¿é†‰è€Œç„¡æ³•å¥½å¥½é‹ä½œ ã‚ã‹ã‚‰ãªã„ã¾ã¾ã§ã‚‚ã¾ãã€ãã‚Œã¯ãã‚Œã§ã‚‚ç¶ºéº—ã  ä½†æ˜¯å¦‚æœå°±é€™æ¨£è¨˜ä¸èµ·ä¾†çš„è©±ã€ä¹Ÿå€’æ˜¯æœ‰å…¶ç¾éº—ä¹‹è™• æ´—é¢å°ã®æ­¯ãƒ–ãƒ©ã‚·ã€èª°ã‹ã®ã‚³ãƒƒãƒ—ã€æ£šã®åŒ–ç²§æ°´ æ´—æ‰‹å°ä¸Šçš„ç‰™åˆ·ã€ä¸çŸ¥é“æ˜¯èª°çš„æ¯å­ã€æ¶å­ä¸Šçš„åŒ–å¦æ°´ è¦šãˆã®ãªã„ç‰©ã°ã‹ã‚Šã  çœ‹åˆ°çš„ç›¡æ˜¯äº›æ²’æœ‰å°è±¡çš„ç‰©å“ æ•ã¯èŠ±ã®åŒ‚ã„ãŒã™ã‚‹ æ•é ­ä¸Šå‚³ä¾†äº†èŠ±çš„é¦™å‘³ ã•ã‚ˆãªã‚‰ã‚’ç½®ã„ã¦åƒ•ã«èŠ±ã‚‚ãŸã› æ‹‹ä¸‹ä¸€å¥å†è¦‹å°±é›¢é–‹çš„å¦³ç‚ºæˆ‘ç•™ä¸‹äº†ä¸€æœµèŠ± è¦šæŸã¬ã¾ã¾ã«å¤œãŒæ˜ã‘ã¦ åœ¨æ²’æœ‰æ„è­˜çš„æƒ…æ³ä¸‹è¿ä¾†äº†é»æ˜ èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§èµ·ãã‚‹ æ–¼ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡é†’ä¾†çš„æˆ‘ ãã®æ¸©ã‚‚ã‚Šä¸€ã¤æ®‹ã—ã¦ èº«æ—åƒ…æ®˜ç•™ä¸€çµ²æº«æš– æ˜¨æ—¥ã®å¤œã®ã“ã¨ã¯ãã“ã¾ã§è¦šãˆã¦ãªã„ã‘ã‚Œã© é›–ç„¶è¨˜ä¸æ¸…æ¥šæ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ… ç¾äººå±€ã‚’ç–‘ã†ã€ãã‚“ãªæ°—ã‚‚ã—ãªã„ã§ã„ã‚‹ ä¹Ÿæ‡·ç–‘éæ˜¯ä¸€å ´ä»™äººè·³ï¼Œä½†å»æ²’æœ‰é‚£ç¨®æ„Ÿè¦º äºŒæ—¥é…”ã„ã‚‚é†’ã‚ãŸé ­ã§è€ƒãˆã¦ã„ãŸã‘ã© å„˜ç®¡å·²ç¶“ç”¨å®¿é†‰éå¾Œçš„è…¦è¢‹æ€è€ƒéäº† ã‚ã‹ã‚‰ãªã„ã¾ã¾ã§ã‚‚ã„ã„ ä½†å»è¦ºå¾—å°±é€™æ¨£æƒ³ä¸èµ·ä¾†ä¹Ÿä¸éŒ¯ ã‚€ã—ã‚ãã®æ–¹ãŒã„ã„ å€’ä¸å¦‚èªªé€™æ¨£æ‰æ˜¯æœ€å¥½çš„ çª“éš›å’²ããƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ã€æ±šã‚ŒãŸã‚·ãƒ³ã‚¯ã€ç·¨ã¿æ›ã‘ã®ãƒãƒ•ãƒ©ãƒ¼ çª—é‚Šç››é–‹çš„è–°è¡£è‰ã€éª¯é«’çš„æ°´æ§½ã€ç·¨ç¹”å¾Œæ›è‘—çš„åœå·¾ è¦šãˆã®ãªã„äº‹ã°ã‹ã‚Šã  æƒ³èµ·ä¾†çš„æ·¨æ˜¯ä¸€äº›ä¸è¨˜å¾—çš„äº‹æƒ… éƒ¨å±‹ã«ã¯æ˜¥ã®åŒ‚ã„ãŒã™ã‚‹ æˆ¿é–“è£¡é£„æ•£è‘—æ˜¥å¤©çš„æ°£æ¯ æµ®é›²æ´ã‚€ã‚ˆã†ãªèŠ±äººå±€ ä»¿ä½›æŠ“ä½æµ®é›²ä¸€èˆ¬çš„èŠ±äººå±€ èª°ã‚‚æ¥ãªã„ã¾ã¾æ—¥ãŒæš®ã‚Œã¦ ç­‰ä¸åˆ°èª°çš„å›ä¾†ï¼Œå°±é€™æ¨£å¤©è‰²æ¼¸æ¼¸æš—ä¸‹ å¤•é™½ã®å·®ã—ãŸçª“ä¸€ã¤ åªç•™ä¸‹ä¸€æ‰‡ç…§é€²å¤•é™½é¤˜æš‰çš„çª—æˆ¶ ä½•ã‚‚çŸ¥ã‚‰ãªã„åƒ•ã‚’æ®‹ã—ã¦ å’Œä¸€ç„¡æ‰€çŸ¥çš„æˆ‘ æ˜¨æ—¥ã®å¤œã®ã“ã¨ã‚‚æœ¬å½“ã¯å°‘ã—è¦šãˆã¦ã‚‹ã‚“ã  æ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ…å…¶å¯¦é‚„è¨˜å¾—ä¸€äº› è²´æ–¹ã®å±…ãªã„æš®ã‚‰ã—ã€ãã‚ŒãŒç¶šãã“ã¨ã‚‚ æ²’æœ‰äº†å¦³çš„ç”Ÿæ´»ã€é‚„æ˜¯æœƒç¹¼çºŒç”Ÿæ´»ä¸‹å» ä»Šã§ã‚‚ã“ã®é ­ä¸€ã¤ã§è€ƒãˆã¦ã„ã‚‹ã°ã‹ã‚Š è‡³ä»Šé‚„æ˜¯ä¸€è‚¡è…¦åœ°å»æƒ³è‘— èŠ±ä¸€ã¤æŒãŸã›ã¦æ¶ˆãˆãŸè²´æ–¹ã®ã“ã¨ ç•™ä¸‹ä¸€æœµèŠ±å¾Œæ¶ˆé€çš„å¦³çš„äº‹æƒ… æ˜æ—¥ã«ã¯ãã£ã¨æˆ»ã£ã¦ãã‚‹ æ˜å¤©å¦³ä¸€å®šæœƒå›ä¾†çš„å§ ä½•æ°—ãªã„é¡”ã§å¸°ã£ã¦ãã‚‹ ä¸€å®šæœƒå¸¶è‘—è‹¥ç„¡å…¶äº‹çš„è¡¨æƒ…å›ä¾†çš„å§ ä»Šã«ãƒ‰ã‚¢ãŒé–‹ã„ã¦èã“ãˆã‚‹ ç”šè‡³ç¾åœ¨æŠŠé–€æ‰“é–‹å¥½åƒå°±èƒ½è½åˆ°å¦³èªª ã”ã‚ã‚“ã­ã€é…ããªã£ãŸã£ã¦ ã€Œå°ä¸èµ·ã€æˆ‘é²åˆ°äº†ã€ è¨€è‘‰ã ã‘ã‚’ãšã£ã¨å¾…ã£ã¦ã„ã‚‹ é€™æ¨£çš„è©±èªæˆ‘ä¸€ç›´åœ¨ç­‰å¾…è‘— å¤•ç„¼ã‘ã‚’ã˜ã£ã¨å¾…ã£ã¦ã„ã‚‹ éœéœåœ°ç­‰å¾…è‘—æ™šéœ å¿˜ã‚Œã¦ã—ã¾ã†å‰ã«èŠ±æã‘ åœ¨å¿˜å»ä¹‹å‰æŠŠèŠ±æœµæç¹ªå‡ºä¾†å§ ä»Šæ—¥ã‚‚ä¸€äººã¾ãŸå¤œãŒæ¥ã¦ ä»Šæ—¥ä¹Ÿæ˜¯ç¨è‡ªè¿ä¾†å¤œæ™š èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§çœ ã‚‹ æˆ‘èƒ½åœ¨ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡ç¡è‘— ãã®æ¸©ã‚‚ã‚Šã€åƒ•ã«æ®‹ã—ã¦ æ˜¯å› ç‚ºæˆ‘é‚„æ®˜å­˜è‘—é‚£ä»½æº«æš– é¦¬é¹¿ã¿ãŸã„ã«æ„›ã¯èŠ±ã‚‚ãŸã› æŠŠåè­½æ‹±æ‰‹è®“äººçš„åƒç¬¨è›‹ä¸€æ¨£çš„æ„› ã“ã®éƒ¨å±‹ã«ã‚‚ã¾ãŸæ˜¥ãŒæ¥ã¦ æ‰èƒ½è®“é€™å€‹æˆ¿é–“å†æ¬¡è¿ä¾†æ˜¥å¤© è²´æ–¹ã®ã„ãªã„è¡—ã‚’ç”Ÿãã‚‹ æˆ‘èƒ½ç”Ÿæ´»åœ¨æ²’æœ‰å¦³çš„è¡—é“ä¸Š ãã®æ¸©ã‚‚ã‚Šã€åƒ•ã«æ®‹ã—ã¦ æ˜¯å› ç‚ºæˆ‘é‚„æ®˜å­˜è‘—é‚£ä»½æº«æš– åƒ•ã«ã²ã¨ã¤ã€èŠ±ã‚’æ®‹ã—ã¦ çµ¦æˆ‘ç•™ä¸‹ä¸€æœµèŠ±çš„é‚£ä»½æº«æš– è¨€è‘‰ã ã‘ã‚’ãšã£ã¨å¾…ã£ã¦ã„ã‚‹ é€™æ¨£çš„è©±èªæˆ‘ä¸€ç›´åœ¨ç­‰å¾…è‘— å¤•ç„¼ã‘ã‚’ã˜ã£ã¨å¾…ã£ã¦ã„ã‚‹ éœéœåœ°ç­‰å¾…è‘—æ™šéœ å¯ä¾›è½‰è¼‰ï¼Œæ¨™æ˜å‡ºè™• ","permalink":"https://yurepo.tw/2020/08/%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB-%E8%8A%B1%E4%BA%BA%E5%B1%80%E7%BF%BB%E8%AD%AF/","summary":"æ­Œæ›²é€£çµ[Youtube Music]\nã•ã‚ˆãªã‚‰ã‚’ç½®ã„ã¦åƒ•ã«èŠ±ã‚‚ãŸã› æ‹‹ä¸‹ä¸€å¥å†è¦‹å°±é›¢é–‹çš„å¦³ç‚ºæˆ‘ç•™ä¸‹äº†ä¸€æœµèŠ± è¦šæŸã¬ã¾ã¾ã«å¤œãŒæ˜ã‘ã¦ åœ¨æ²’æœ‰æ„è­˜çš„æƒ…æ³ä¸‹è¿ä¾†äº†é»æ˜ èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§èµ·ããŸ æ–¼ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡é†’ä¾†çš„æˆ‘ ãã®æ¸©ã‚‚ã‚Šä¸€ã¤æ®‹ã—ã¦ èº«æ—åƒ…æ®˜ç•™ä¸€çµ²æº«æš– æ˜¨æ—¥ã®å¤œã®ã“ã¨ã¯å°‘ã—ã‚‚è¦šãˆã¦ãªã„ã‘ã‚Œã© é›–ç„¶ä¸€é»ä¹Ÿè¨˜ä¸èµ·ä¾†æ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ… ä»–ã«èª°ã‹ãŒå±…ãŸã€ãã‚“ãªæ°—ãŒãŸã ã—ã¦ã„ã‚‹ ä¹Ÿåªæ˜¯æ„Ÿè¦ºæ˜¨æ™šä¼¼ä¹é‚„æœ‰èª°åœ¨çš„æ¨£å­ äºŒæ—¥é…”ã„ãŒæ®‹ã‚‹é ­ã¯å›ã£ã¡ã‚ƒã„ãªã„ã‘ã‚Œã© é›–ç„¶è…¦è¢‹é‚„å› ç‚ºå®¿é†‰è€Œç„¡æ³•å¥½å¥½é‹ä½œ ã‚ã‹ã‚‰ãªã„ã¾ã¾ã§ã‚‚ã¾ãã€ãã‚Œã¯ãã‚Œã§ã‚‚ç¶ºéº—ã  ä½†æ˜¯å¦‚æœå°±é€™æ¨£è¨˜ä¸èµ·ä¾†çš„è©±ã€ä¹Ÿå€’æ˜¯æœ‰å…¶ç¾éº—ä¹‹è™• æ´—é¢å°ã®æ­¯ãƒ–ãƒ©ã‚·ã€èª°ã‹ã®ã‚³ãƒƒãƒ—ã€æ£šã®åŒ–ç²§æ°´ æ´—æ‰‹å°ä¸Šçš„ç‰™åˆ·ã€ä¸çŸ¥é“æ˜¯èª°çš„æ¯å­ã€æ¶å­ä¸Šçš„åŒ–å¦æ°´ è¦šãˆã®ãªã„ç‰©ã°ã‹ã‚Šã  çœ‹åˆ°çš„ç›¡æ˜¯äº›æ²’æœ‰å°è±¡çš„ç‰©å“ æ•ã¯èŠ±ã®åŒ‚ã„ãŒã™ã‚‹ æ•é ­ä¸Šå‚³ä¾†äº†èŠ±çš„é¦™å‘³ ã•ã‚ˆãªã‚‰ã‚’ç½®ã„ã¦åƒ•ã«èŠ±ã‚‚ãŸã› æ‹‹ä¸‹ä¸€å¥å†è¦‹å°±é›¢é–‹çš„å¦³ç‚ºæˆ‘ç•™ä¸‹äº†ä¸€æœµèŠ± è¦šæŸã¬ã¾ã¾ã«å¤œãŒæ˜ã‘ã¦ åœ¨æ²’æœ‰æ„è­˜çš„æƒ…æ³ä¸‹è¿ä¾†äº†é»æ˜ èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§èµ·ãã‚‹ æ–¼ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡é†’ä¾†çš„æˆ‘ ãã®æ¸©ã‚‚ã‚Šä¸€ã¤æ®‹ã—ã¦ èº«æ—åƒ…æ®˜ç•™ä¸€çµ²æº«æš– æ˜¨æ—¥ã®å¤œã®ã“ã¨ã¯ãã“ã¾ã§è¦šãˆã¦ãªã„ã‘ã‚Œã© é›–ç„¶è¨˜ä¸æ¸…æ¥šæ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ… ç¾äººå±€ã‚’ç–‘ã†ã€ãã‚“ãªæ°—ã‚‚ã—ãªã„ã§ã„ã‚‹ ä¹Ÿæ‡·ç–‘éæ˜¯ä¸€å ´ä»™äººè·³ï¼Œä½†å»æ²’æœ‰é‚£ç¨®æ„Ÿè¦º äºŒæ—¥é…”ã„ã‚‚é†’ã‚ãŸé ­ã§è€ƒãˆã¦ã„ãŸã‘ã© å„˜ç®¡å·²ç¶“ç”¨å®¿é†‰éå¾Œçš„è…¦è¢‹æ€è€ƒéäº† ã‚ã‹ã‚‰ãªã„ã¾ã¾ã§ã‚‚ã„ã„ ä½†å»è¦ºå¾—å°±é€™æ¨£æƒ³ä¸èµ·ä¾†ä¹Ÿä¸éŒ¯ ã‚€ã—ã‚ãã®æ–¹ãŒã„ã„ å€’ä¸å¦‚èªªé€™æ¨£æ‰æ˜¯æœ€å¥½çš„ çª“éš›å’²ããƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ã€æ±šã‚ŒãŸã‚·ãƒ³ã‚¯ã€ç·¨ã¿æ›ã‘ã®ãƒãƒ•ãƒ©ãƒ¼ çª—é‚Šç››é–‹çš„è–°è¡£è‰ã€éª¯é«’çš„æ°´æ§½ã€ç·¨ç¹”å¾Œæ›è‘—çš„åœå·¾ è¦šãˆã®ãªã„äº‹ã°ã‹ã‚Šã  æƒ³èµ·ä¾†çš„æ·¨æ˜¯ä¸€äº›ä¸è¨˜å¾—çš„äº‹æƒ… éƒ¨å±‹ã«ã¯æ˜¥ã®åŒ‚ã„ãŒã™ã‚‹ æˆ¿é–“è£¡é£„æ•£è‘—æ˜¥å¤©çš„æ°£æ¯ æµ®é›²æ´ã‚€ã‚ˆã†ãªèŠ±äººå±€ ä»¿ä½›æŠ“ä½æµ®é›²ä¸€èˆ¬çš„èŠ±äººå±€ èª°ã‚‚æ¥ãªã„ã¾ã¾æ—¥ãŒæš®ã‚Œã¦ ç­‰ä¸åˆ°èª°çš„å›ä¾†ï¼Œå°±é€™æ¨£å¤©è‰²æ¼¸æ¼¸æš—ä¸‹ å¤•é™½ã®å·®ã—ãŸçª“ä¸€ã¤ åªç•™ä¸‹ä¸€æ‰‡ç…§é€²å¤•é™½é¤˜æš‰çš„çª—æˆ¶ ä½•ã‚‚çŸ¥ã‚‰ãªã„åƒ•ã‚’æ®‹ã—ã¦ å’Œä¸€ç„¡æ‰€çŸ¥çš„æˆ‘ æ˜¨æ—¥ã®å¤œã®ã“ã¨ã‚‚æœ¬å½“ã¯å°‘ã—è¦šãˆã¦ã‚‹ã‚“ã  æ˜¨å¤©æ™šä¸Šç™¼ç”Ÿéçš„äº‹æƒ…å…¶å¯¦é‚„è¨˜å¾—ä¸€äº› è²´æ–¹ã®å±…ãªã„æš®ã‚‰ã—ã€ãã‚ŒãŒç¶šãã“ã¨ã‚‚ æ²’æœ‰äº†å¦³çš„ç”Ÿæ´»ã€é‚„æ˜¯æœƒç¹¼çºŒç”Ÿæ´»ä¸‹å» ä»Šã§ã‚‚ã“ã®é ­ä¸€ã¤ã§è€ƒãˆã¦ã„ã‚‹ã°ã‹ã‚Š è‡³ä»Šé‚„æ˜¯ä¸€è‚¡è…¦åœ°å»æƒ³è‘— èŠ±ä¸€ã¤æŒãŸã›ã¦æ¶ˆãˆãŸè²´æ–¹ã®ã“ã¨ ç•™ä¸‹ä¸€æœµèŠ±å¾Œæ¶ˆé€çš„å¦³çš„äº‹æƒ… æ˜æ—¥ã«ã¯ãã£ã¨æˆ»ã£ã¦ãã‚‹ æ˜å¤©å¦³ä¸€å®šæœƒå›ä¾†çš„å§ ä½•æ°—ãªã„é¡”ã§å¸°ã£ã¦ãã‚‹ ä¸€å®šæœƒå¸¶è‘—è‹¥ç„¡å…¶äº‹çš„è¡¨æƒ…å›ä¾†çš„å§ ä»Šã«ãƒ‰ã‚¢ãŒé–‹ã„ã¦èã“ãˆã‚‹ ç”šè‡³ç¾åœ¨æŠŠé–€æ‰“é–‹å¥½åƒå°±èƒ½è½åˆ°å¦³èªª ã”ã‚ã‚“ã­ã€é…ããªã£ãŸã£ã¦ ã€Œå°ä¸èµ·ã€æˆ‘é²åˆ°äº†ã€ è¨€è‘‰ã ã‘ã‚’ãšã£ã¨å¾…ã£ã¦ã„ã‚‹ é€™æ¨£çš„è©±èªæˆ‘ä¸€ç›´åœ¨ç­‰å¾…è‘— å¤•ç„¼ã‘ã‚’ã˜ã£ã¨å¾…ã£ã¦ã„ã‚‹ éœéœåœ°ç­‰å¾…è‘—æ™šéœ å¿˜ã‚Œã¦ã—ã¾ã†å‰ã«èŠ±æã‘ åœ¨å¿˜å»ä¹‹å‰æŠŠèŠ±æœµæç¹ªå‡ºä¾†å§ ä»Šæ—¥ã‚‚ä¸€äººã¾ãŸå¤œãŒæ¥ã¦ ä»Šæ—¥ä¹Ÿæ˜¯ç¨è‡ªè¿ä¾†å¤œæ™š èª°ã‚‚ã„ãªã„éƒ¨å±‹ã§çœ ã‚‹ æˆ‘èƒ½åœ¨ç©ºç„¡ä¸€äººçš„æˆ¿é–“è£¡ç¡è‘— ãã®æ¸©ã‚‚ã‚Šã€åƒ•ã«æ®‹ã—ã¦ æ˜¯å› ç‚ºæˆ‘é‚„æ®˜å­˜è‘—é‚£ä»½æº«æš– é¦¬é¹¿ã¿ãŸã„ã«æ„›ã¯èŠ±ã‚‚ãŸã› æŠŠåè­½æ‹±æ‰‹è®“äººçš„åƒç¬¨è›‹ä¸€æ¨£çš„æ„› ã“ã®éƒ¨å±‹ã«ã‚‚ã¾ãŸæ˜¥ãŒæ¥ã¦ æ‰èƒ½è®“é€™å€‹æˆ¿é–“å†æ¬¡è¿ä¾†æ˜¥å¤© è²´æ–¹ã®ã„ãªã„è¡—ã‚’ç”Ÿãã‚‹ æˆ‘èƒ½ç”Ÿæ´»åœ¨æ²’æœ‰å¦³çš„è¡—é“ä¸Š ãã®æ¸©ã‚‚ã‚Šã€åƒ•ã«æ®‹ã—ã¦ æ˜¯å› ç‚ºæˆ‘é‚„æ®˜å­˜è‘—é‚£ä»½æº«æš– åƒ•ã«ã²ã¨ã¤ã€èŠ±ã‚’æ®‹ã—ã¦ çµ¦æˆ‘ç•™ä¸‹ä¸€æœµèŠ±çš„é‚£ä»½æº«æš– è¨€è‘‰ã ã‘ã‚’ãšã£ã¨å¾…ã£ã¦ã„ã‚‹ é€™æ¨£çš„è©±èªæˆ‘ä¸€ç›´åœ¨ç­‰å¾…è‘— å¤•ç„¼ã‘ã‚’ã˜ã£ã¨å¾…ã£ã¦ã„ã‚‹ éœéœåœ°ç­‰å¾…è‘—æ™šéœ å¯ä¾›è½‰è¼‰ï¼Œæ¨™æ˜å‡ºè™• ","title":"ãƒ¨ãƒ«ã‚·ã‚« - èŠ±äººå±€ã€ç¿»è­¯ã€‘"},{"content":"é€™å¹¾å¤©åœ¨æº–å‚™ä¸Šèª²æ•™æï¼Œæ‰€ä»¥å›é ­åšäº†ä¸€äº›æŠ€è—ç«¶è³½çš„æ­·å±†è€ƒé¡Œ æˆ‘é‚„è¨˜å¾—ä»¥å‰æœ‰ä¸€é¡Œåœ¨æˆ‘é«˜ä¸­çš„æ™‚å€™èŠ±äº†å°‡è¿‘å¹¾å¤©åœ¨æƒ³ç­”æ¡ˆï¼Œå›å»é‡åšç™¼ç¾\u0026hellip;\u0026hellip;\nä»€éº¼é¬¼???ä¸å°±åªæ˜¯éè¿´è€Œå·²\u0026hellip; é‡å¯«å¾Œç™¼ç¾çŒœæƒ³çœŸçš„æ˜¯å°çš„ï¼Œå¯èƒ½ç•¶æ™‚ç·´ç¿’çš„æ™‚å€™é ­è…¦æœ‰é»æ··äº‚å§ï¼ŒåŸæœ¬æ˜¯å¯«äº†ä¸‰ã€å››å€‹è¿´åœˆåœ¨è£¡é¢è·‘ï¼Œæœ‰äº›æ•¸å­—é‚„æœƒç›´æ¥ç•¶æ‰ä¸çµ¦å‹•åªèƒ½èªªç•¶æ™‚å¤ªç¬¨äº†\u0026hellip; å¸Œæœ›å›å»å­¸æ ¡æ•™çš„æ™‚å€™å­¸å¼Ÿä¸è¦å¤ªè°æ˜ï¼Œä¸ç„¶ç•¶æ™‚çš„æˆ‘æœƒç«™ä¸äº†æª¯é¢é˜¿é˜¿é˜¿ã€‚ å› ç‚ºå¤ªä¸Ÿäººäº†ç¨‹å¼ç¢¼å°±ä¸æ”¾ä¸Šä¾†äº†ã€‚\n","permalink":"https://yurepo.tw/2020/08/%E5%9B%9E%E9%A0%AD%E7%9C%8B%E7%95%B6%E5%B9%B4%E6%8A%80%E8%97%9D%E7%AB%B6%E8%B3%BD%E9%A1%8C%E7%9B%AE/","summary":"é€™å¹¾å¤©åœ¨æº–å‚™ä¸Šèª²æ•™æï¼Œæ‰€ä»¥å›é ­åšäº†ä¸€äº›æŠ€è—ç«¶è³½çš„æ­·å±†è€ƒé¡Œ æˆ‘é‚„è¨˜å¾—ä»¥å‰æœ‰ä¸€é¡Œåœ¨æˆ‘é«˜ä¸­çš„æ™‚å€™èŠ±äº†å°‡è¿‘å¹¾å¤©åœ¨æƒ³ç­”æ¡ˆï¼Œå›å»é‡åšç™¼ç¾\u0026hellip;\u0026hellip;\nä»€éº¼é¬¼???ä¸å°±åªæ˜¯éè¿´è€Œå·²\u0026hellip; é‡å¯«å¾Œç™¼ç¾çŒœæƒ³çœŸçš„æ˜¯å°çš„ï¼Œå¯èƒ½ç•¶æ™‚ç·´ç¿’çš„æ™‚å€™é ­è…¦æœ‰é»æ··äº‚å§ï¼ŒåŸæœ¬æ˜¯å¯«äº†ä¸‰ã€å››å€‹è¿´åœˆåœ¨è£¡é¢è·‘ï¼Œæœ‰äº›æ•¸å­—é‚„æœƒç›´æ¥ç•¶æ‰ä¸çµ¦å‹•åªèƒ½èªªç•¶æ™‚å¤ªç¬¨äº†\u0026hellip; å¸Œæœ›å›å»å­¸æ ¡æ•™çš„æ™‚å€™å­¸å¼Ÿä¸è¦å¤ªè°æ˜ï¼Œä¸ç„¶ç•¶æ™‚çš„æˆ‘æœƒç«™ä¸äº†æª¯é¢é˜¿é˜¿é˜¿ã€‚ å› ç‚ºå¤ªä¸Ÿäººäº†ç¨‹å¼ç¢¼å°±ä¸æ”¾ä¸Šä¾†äº†ã€‚","title":"å›é ­çœ‹ç•¶å¹´æŠ€è—ç«¶è³½é¡Œç›®"},{"content":"é¡Œç›®è¦æ±‚æ˜¯è¦è¼¸å…¥ä¸€å€‹é‹ç®—å¼å›å‚³è©²é‹ç®—å¼çš„çµæœ æœ‰ä¸‹åˆ—è¦å‰‡\n \u0026ldquo;t\u0026rdquo;ï¼Œä»£è¡¨ç‚º True \u0026ldquo;f\u0026rdquo;ï¼Œä»£è¡¨ç‚º False \u0026ldquo;!(expr)\u0026quot;ï¼Œè¡¨ç¤ºå°‡exprå¾—å‡ºçš„å¸ƒæ—å€¼åå‘ \u0026ldquo;\u0026amp;(expr1,expr2,\u0026hellip;)\u0026quot;ï¼Œè¡¨ç¤ºå°‡æ‰€æœ‰expr{num}åšAND \u0026ldquo;|(expr1,expr2,\u0026hellip;)\u0026quot;ï¼Œè¡¨ç¤ºå°‡æ‰€æœ‰expr{num}åšOR  é¦¬ä¸Šé€²å…¥ç¨‹å¼ç¢¼æ’°å¯«çš„éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä»¥éè¿´è§£æ±º æˆ‘çš„æƒ³æ³•æ‡‰è©²ç®—è »å·®çš„ï¼Œæ•ˆèƒ½é‚£äº›éƒ¨åˆ†éƒ½ä¸èƒ½å¼·æ±‚ï¼Œæ‰€ä»¥åƒ…æ”¾ä¸Šä¾†åšåƒè€ƒï¼Œæ­¡è¿åº•ä¸‹è¨è«–\nclass Solution { companion object{ // é‹ç®—å­åˆ—è¡¨  val operator = arrayOf(\u0026#39;!\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;|\u0026#39;) } fun parseBoolExpr(expression: String): Boolean { // å¦‚æœé‹ç®—å¼ç‚ºç©ºï¼Œå›å‚³ `False`  if (expression.isEmpty()) return false return expr(expression) } fun expr(expression: String): Boolean{ // å¦‚æœé‹ç®—å¼çš„é¦–å€‹å…ƒç´ ä¸åŒ…å«æ–¼é‹ç®—å­åˆ—è¡¨(!ã€\u0026amp;ã€|)ï¼Œå›å‚³ `False`  if (!operator.contains(expression[0])) return false // å–å¾—é‹ç®—å­  val mod = expression[0] // æª¢æŸ¥é‹ç®—å­å¾Œçš„ä¸‹ä¸€å€‹å­—å…ƒæ˜¯å¦ç‚º `(`  val optStart = if(expression[1] == \u0026#39;(\u0026#39;) 1 else throw RuntimeException(\u0026#34;not valid pattern\u0026#34;) // æª¢æŸ¥é‹ç®—å¼çš„æœ€å¾Œä¸€å€‹å­—æºæ˜¯å¦ç‚º `)`  val optEnd = if(expression[expression.lastIndex] == \u0026#39;)\u0026#39;) expression.lastIndex else throw RuntimeException(\u0026#34;not valid pattern\u0026#34;) val arg = arrayListOf\u0026lt;Boolean\u0026gt;() var index = optStart while(index \u0026lt;= optEnd){ // å¦‚æœéœ€è¦éè¿´è§£æ±º  if (operator.contains(expression[index])){ val segStartIndex = index + 1 // å°‹æ‰¾æ‹¬å¼§çš„çµæŸé»  val segEndIndex = findPair(expression, segStartIndex) // éè¿´è§£æ±ºä¸¦å°‡çµæœæ–°å¢åˆ°åˆ—è¡¨ä¸­  arg.add(expr(expression.substring(index, segEndIndex))) // é‹ç®—å®Œæˆå¾Œç•¥éå·²ç¶“é‹ç®—å®Œæˆçš„é‹ç®—å¼  index = segEndIndex + 1 } else{ //ä¸éœ€è¦éè¿´è§£æ±ºçš„è©±å°±ç›´æ¥æ–°å¢åˆ°åˆ—è¡¨ä¸­  when (expression[index]){ \u0026#39;t\u0026#39; -\u0026gt; arg.add(true) \u0026#39;f\u0026#39; -\u0026gt; arg.add(false) } index++ } } return calculartor(mod, arg).apply { println(\u0026#34;matching $expressionresult: $this\u0026#34;) } } fun findPair(expr: String, startIndex: Int): Int{ var pass = 0 expr.substring(startIndex).forEachIndexed { index, item -\u0026gt; when(item){ \u0026#39;(\u0026#39; -\u0026gt; pass++ \u0026#39;)\u0026#39; -\u0026gt; pass-- } if (item == \u0026#39;)\u0026#39; \u0026amp;\u0026amp; pass == 0){ return index + startIndex + 1 } } return -1 } fun calculartor(mod: Char, list: List\u0026lt;Boolean\u0026gt;): Boolean { when(mod){ \u0026#39;!\u0026#39; -\u0026gt; { return !list[0] } \u0026#39;\u0026amp;\u0026#39; -\u0026gt; { return !list.contains(false) } \u0026#39;|\u0026#39; -\u0026gt; { return list.contains(true) } } return false } } ","permalink":"https://yurepo.tw/2020/08/parsing-a-boolean-expression/","summary":"é¡Œç›®è¦æ±‚æ˜¯è¦è¼¸å…¥ä¸€å€‹é‹ç®—å¼å›å‚³è©²é‹ç®—å¼çš„çµæœ æœ‰ä¸‹åˆ—è¦å‰‡\n \u0026ldquo;t\u0026rdquo;ï¼Œä»£è¡¨ç‚º True \u0026ldquo;f\u0026rdquo;ï¼Œä»£è¡¨ç‚º False \u0026ldquo;!(expr)\u0026quot;ï¼Œè¡¨ç¤ºå°‡exprå¾—å‡ºçš„å¸ƒæ—å€¼åå‘ \u0026ldquo;\u0026amp;(expr1,expr2,\u0026hellip;)\u0026quot;ï¼Œè¡¨ç¤ºå°‡æ‰€æœ‰expr{num}åšAND \u0026ldquo;|(expr1,expr2,\u0026hellip;)\u0026quot;ï¼Œè¡¨ç¤ºå°‡æ‰€æœ‰expr{num}åšOR  é¦¬ä¸Šé€²å…¥ç¨‹å¼ç¢¼æ’°å¯«çš„éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä»¥éè¿´è§£æ±º æˆ‘çš„æƒ³æ³•æ‡‰è©²ç®—è »å·®çš„ï¼Œæ•ˆèƒ½é‚£äº›éƒ¨åˆ†éƒ½ä¸èƒ½å¼·æ±‚ï¼Œæ‰€ä»¥åƒ…æ”¾ä¸Šä¾†åšåƒè€ƒï¼Œæ­¡è¿åº•ä¸‹è¨è«–\nclass Solution { companion object{ // é‹ç®—å­åˆ—è¡¨  val operator = arrayOf(\u0026#39;!\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;|\u0026#39;) } fun parseBoolExpr(expression: String): Boolean { // å¦‚æœé‹ç®—å¼ç‚ºç©ºï¼Œå›å‚³ `False`  if (expression.isEmpty()) return false return expr(expression) } fun expr(expression: String): Boolean{ // å¦‚æœé‹ç®—å¼çš„é¦–å€‹å…ƒç´ ä¸åŒ…å«æ–¼é‹ç®—å­åˆ—è¡¨(!ã€\u0026amp;ã€|)ï¼Œå›å‚³ `False`  if (!operator.contains(expression[0])) return false // å–å¾—é‹ç®—å­  val mod = expression[0] // æª¢æŸ¥é‹ç®—å­å¾Œçš„ä¸‹ä¸€å€‹å­—å…ƒæ˜¯å¦ç‚º `(`  val optStart = if(expression[1] == \u0026#39;(\u0026#39;) 1 else throw RuntimeException(\u0026#34;not valid pattern\u0026#34;) // æª¢æŸ¥é‹ç®—å¼çš„æœ€å¾Œä¸€å€‹å­—æºæ˜¯å¦ç‚º `)`  val optEnd = if(expression[expression.","title":"Parsing A Boolean Expression"},{"content":"HelloWorld | JVM å› ç‚ºæ˜¯éƒ¨è½æ ¼ä¸Šçš„ç¬¬ä¸€ç¯‡ï¼Œæ‰€ä»¥æƒ³ä¾†æ¸¬è©¦åŸºæœ¬èªæ³•é«˜äº® é¦–å…ˆæ˜¯Java\n// æ¸¬è©¦Javaè¨»è§£ public static void main(string[] args){ System.out.println(\u0026#34;hello world\u0026#34;); } æ¥ä¸‹ä¾†æ˜¯Kotlin\nfun main(){ \u0026#34;hello world\u0026#34;.println() } fun String.println(){ println(this) } æœ€å¾ŒåŸºæœ¬çš„Cèªè¨€å¥½äº†\nint main(){ printf(\u0026#34;hello world\u0026#34;); return 0; } ","permalink":"https://yurepo.tw/2020/08/helloworld-jvm/","summary":"HelloWorld | JVM å› ç‚ºæ˜¯éƒ¨è½æ ¼ä¸Šçš„ç¬¬ä¸€ç¯‡ï¼Œæ‰€ä»¥æƒ³ä¾†æ¸¬è©¦åŸºæœ¬èªæ³•é«˜äº® é¦–å…ˆæ˜¯Java\n// æ¸¬è©¦Javaè¨»è§£ public static void main(string[] args){ System.out.println(\u0026#34;hello world\u0026#34;); } æ¥ä¸‹ä¾†æ˜¯Kotlin\nfun main(){ \u0026#34;hello world\u0026#34;.println() } fun String.println(){ println(this) } æœ€å¾ŒåŸºæœ¬çš„Cèªè¨€å¥½äº†\nint main(){ printf(\u0026#34;hello world\u0026#34;); return 0; } ","title":"HelloWorld | JVM"}]